---
description: >-
  検証者になり、eth2、プルーフ・オブ・ステーク・ブロックチェーンの安全性を確保するのに役立ちます。 ETH32をお持ちの方なら誰でも参加できます。
---

# ガイド \| ETH2 testnet でバリデータをセットアップする方法

{% hint style="success" %}
2020年12月24日現在、このガイドは **testnet Pyrmontのために更新されています。**😁
{% endhint %}

#### ✨ メインネットガイドについては、 [こちら](guide-or-how-to-setup-a-validator-on-eth2-mainnet/) をクリックしてください。

🎊 **2020-12 Update**: Thanks to all [Gitcoin](https://gitcoin.co/grants/1653/eth2-staking-guides-by-coincashew) contributors, where you can contribute via [quadratic funding](https://vitalik.ca/general/2019/12/07/quadratic.html) and make a big impact. 資金調達完了！ ありがとうございます!🙏

{% embed url="https://gitcoin.co/grants/1653/eth2-staking-guides-by-constashew" %}

## 🏁 0. 前提条件

### 👩💻eth2 バリデータとビーコンノードを操作するためのスキル

eth2 のバリデータとして、通常、以下のような能力があります。

* eth2ビーコンノードと検証器の設置方法、実行、維持方法に関する運用上の知識
* 24時間365日体制で検証を維持するという長期的な取り組みです
* 基本的なオペレーティングシステムのスキル

### 👨💻 バリデータに成功するために必要な経験

* has known beginners for Beginners' by Superphiz ['Intro to Eth2 & Staking for Beginners' by Superphiz](https://www.youtube.com/watch?v=tpkpW031RCI)
* [Eth2 Study Master course](https://ethereumstudymaster.com/) に合格または登録されています
* そして、 [8 Things Every Eth2 validatorが知っておくべきである](https://medium.com/chainsafe-systems/8-things-every-eth2-validator-should-know-before-staking-94df41701487)

### 🎗 **最低設定要件**

* **オペレーティングシステム:** 64 ビット Linux \(i.) Ubuntu 20.04 LTSサーバまたはデスクトップ)
* **プロセッサ:** デュアルコア CPU、Intel Core i5–760 または AMD FX-8100 以上
* **Memory:** 8GB RAM
* **ストレージ:** 20GB SSD
* **インターネット:** 少なくとも1 Mbpsの速度でブロードバンドのインターネット接続。
* **電力:** 信頼性の高い電力。
* **ETH残高:** 少なくとも32goerli ETHといくつかのETHで入金取引手数料がかかります
* **ウォレット**: メタマスクがインストールされました

### 🏋♂ 推奨ハードウェア設定

* **オペレーティングシステム:** 64 ビット Linux \(i.) Ubuntu 20.04 LTSサーバまたはデスクトップ)
* **プロセッサ:** クワッドコア CPU、Intel Core i7-4770 または AMD FX-8310 以上
* **メモリ:** 16GB RAM 以上
* **ストレージ:** 1TB SSD 以上
* **インターネット:** データ制限のない10Mbps以上の速度でブロードバンドインターネット接続。
* **電源:** 無停電電源\(UPS\) による信頼性の高い電力
* **ETH残高:** 少なくとも32goerli ETHといくつかのETHで入金取引手数料がかかります
* **ウォレット**: メタマスクがインストールされました

{% hint style="success" %}
✨ **Pro Validator Tip**: OS、VM、またはマシンの新しいインスタンスから始めることを強くお勧めします。 テストネットキー、ウォレット、データベースを再利用しないことで、頭痛を避けることができます。
{% endhint %}

### 🔓 推奨されるeth2バリデータセキュリティのベストプラクティス。

バリデータを保護するためのアイデアやリマインダーが必要な場合は、こちらを参照してください

{% page-ref page="guide-or-security-best-practices-for-a-eth2-validator-beaconchain-node.md" %}

### 🛠 Setup Ubuntu

Ubuntu Serverをインストールする必要がある場合は、

{% embed url="https://ubuntu.com/tutorials/install-ubuntu-server\#1-overview" %}

Ubuntu のデスクトップ

{% page-ref page="../overview-xtz/guide-how-to-setup-a-baker/install-ubuntu.md" %}

### 🎭 メタマスクの設定

メタマスクをインストールする必要がある場合は、

{% page-ref page="../../wallets/browser-wallets/metamask-ethereum.md" %}

### 🧩 ハイレベル検証ノードの概要

{% hint style="info" %}
このガイドの最後に、3つの主要コンポーネントをホストするマシンを構築します:バリデータクライアント。 ビーコンチェーンクライアントとeth1ノードだ

**Validator クライアント** - ビーコンチェーンとシャードチェーンで新しいブロックと認証を生成する責任を負う。

**Beacon chain client** - Beacon chain, validator shufflingなどの状態の管理を担当。

**Eth1 node** - ビーコンチェーンクライアントにeth1 メインネットチェーンからのバリデーター入金を供給する。

注:TekuとNimbusは両方のクライアントを1つのプロセスに統合します。
{% endhint %}

![eth2はLeslieをフィーチャーし、アメリカのコンピュータサイエンティストLeslie Lamportにちなんで名付けられたマスコットeth2 Rhinoをフィーチャーします。](../../.gitbook/assets/eth2network.png)

## 🌱 1. testnet ETHを取得

{% hint style="info" %}
あなたが所有するすべての32ETHは、1バリデータを作成することができます。 ビーコンノードで何千ものバリデータを実行できます。 しかし、testnetでは、アクティベーションキューを合理的に迅速に保つために、1つまたは2つのバリデータのみを実行してください。
{% endhint %}

[プライスマティックラボのDiscord](https://discord.com/invite/YMVYzv6) に参加して、 **`-request-goerli-ethチャンネル`**でETHのリクエストを送信してください。

```text
!send <your metamask goerli network ETH address>
```

それ以外の場合は、:potable_waterを参照してください:[Goerli Authenticated Faucet](https://faucet.goerli.mudit.blog/).

## 👩💻 2. Launchpadでバリデータにサインアップする

1. 依存関係、イーサリアム財団デポジットツールをインストールし、キーペアのあなたの2セットを生成します。

{% hint style="info" %}
各バリデータには2つのキーペアがあります。 **署名キー** と **引き出しキー** これらのキーは 1 つのニーモニックフレーズから派生します。 [キーについての詳細はこちら](https://blog.ethereum.org/2020/05/21/keys/)
{% endhint %}

ビルド済みの [イーサリアム財団デポジットツール](https://github.com/ethereum/eth2.0-deposit-cli) をダウンロードするか、ソースからビルドするかを選択できます。

{% tabs %}
{% tab title="Build from source code" %}
依存関係のインストール

```text
sudo apt update
sudo apt install python3-pip git -y
```

ソースコードをダウンロードしてインストールします。

```text
cd $HOME
git clone https://github.com/eth2.0-deposit-cli.git eth2deposit-cli
cd eth2deposit-cli
sudo ./deposit.sh install
```

新しいニーモニックを作ります。

```text
./deposit.sh new-mnemonic --chain pyrmont
```
{% endtab %}

{% tab title="Pre-built eth2deposit-cli" %}
eth2deposit-cliをダウンロード

```bash
cd $HOME
wget https://github.com/eth2.0-deposit-cli/releases/download/v1.1.0/eth2deposit-cli-ed5a6d3-linux-amd64.tar.gz
```

SHA256 チェックサムが、 [リリース ページ](https://github.com/ethereum/eth2.0-deposit-cli/releases/tag/v1.0.0) のチェックサムと一致することを確認します。

```bash
echo "2107f26f9545f423530e3501ae616c222b6bf77774a4f274bcbe7 *eth2deposit-cli-ed5a6d3-linux-amd64.tar.gz" | shasum -a 256 ---check
```

有効な出力例:

> eth2deposit-cli-ed5a6d3-linux-amd64.tar.gz: OK

{% hint style="danger" %}
sha256 チェックが **OK** で渡された場合にのみ続行!
{% endhint %}

アーカイブを展開します。

```text
tar -xvf eth2deposit-cli-ed5a6d3-linux-amd64.tar.gz
mv eth2deposit-cli-ed5a6d3-linux-amd64 eth2deposit-cli
rm eth2deposit-cli-ed5a6d3-linux-amd64.tar.gz
cd eth2deposit-cli
```

新しいニーモニックを作ります。

```text
./deposit new-mnemonic --chain pyrmont
```
{% endtab %}

{% tab title="Advanced - Most Secure" %}
{% hint style="warning" %}
🔥**\[ Optional \] Pro Security Tip**: **eth2deposit-cli ツール** を実行し、 **mnemonic seed** を作成します。 **usb から起動されたエアーギャップ付きオフラインマシンの** 上で、バリデータキーを生成します。
{% endhint %}

起動可能な usb を作る際に、この [ethstaker.cc](https://ethstaker.cc/) をローダウン専用にフォローしてください。

### パート1 - Ubuntu 20.04 USBブート可能なドライブを作成

{% embed url="https://www.youtube.com/watch?v=DTR3PzRtYU" %}

### パート2 - USBドライブからUbuntu 20.04をインストールします

{% embed url="https://www.youtube.com/watch?v=C97\_6MrufCE" %}

USBキーを介して、USBから起動されたエアラップされたオフラインマシンにオンラインマシンから、事前に構築されたeth2deposit-cliバイナリをコピーすることができます。 イーサネットケーブルおよび/またはWi-Fiを取り外してください。
{% endtab %}
{% endtabs %}

{% hint style="danger" %}
**このプロセス中に実際のメインネットETHを送信しないでください!** 🛑 goerli ETHのみを使用してください。
{% endhint %}

1. プロンプトに従って、 **キーストアのパスワード** を選択します。 このパスワードはキーストアファイルを暗号化します。 あなたのニーモニックを書き留めて、この安全と **オフライン**を維持してください。
2. [https://pyrmont.launchpad.ethereum.org/](https://pyrmont.launchpad.ethereum.org/) の手順に従ってください。 eth2フェーズ0の概要材料を研究する。 eth2を理解することが成功の鍵です!
3. `validator_keys` ディレクトリにある `deposit_data-#########.json` をアップロードします。
4. メタマスクウォレット、レビューと受け入れ条件でランチパッドに接続します。
5. トランザクションを確認\(s\). バリデーターごとに32ETHのデポジットトランザクションがあります。

{% hint style="info" %}
あなたの取引はあなたのETHをpyrmont ETH2入金契約アドレスに送金し、入金します。

****, _ダブルチェック_, _**トリプルチェック**_ pyrmont Eth2デポジットコントラクトアドレスが正しいことを確認します。

[0x8c5fecdC472E27Bc447696F431E425D02dd46a8c](https://goerli.etherscan.io/address/0x8c5fecdc472e27bc447696f431e425d02dd46a8c)
{% endhint %}

{% hint style="danger" %}
\*\*\*🔥 **重要な暗号リマインダー:** **あなたの記憶を保ち、ETHを保ちましょう。**🚀

* ニーモニックシード **オフライン**を書き留めてください。 _電子メールではありません。 クラウドではありません。_
* 複数のコピーが良い。 __ [_メタルシードに最も保存されている。_](https://jlopp.github.io/metal-bitcoin-storage-reviews/)
* 今後、このニーモニックから引き出しキーが生成されます。
* ****ディレクトリの **`validator_keys`** などのオフラインバックアップ ` を作成します。
</p>

<p spaces-before="0">{% endhint %}</p></li>
</ul>

<h2 spaces-before="0">🛸 3. Install a ETH1 node</h2>

<p spaces-before="0">{% hint style="info" %}</p>

<p spaces-before="0">
Ethereum 2.0は、32 ETHバリデータデポジットを監視するためにEthereum 1.0への接続が必要です。 独自のEthereum 1.0ノードをホストすることは、分散化を最大化し、Infuraなどの第三者への依存を最小限に抑える最良の方法です。
</p>

<p spaces-before="0">{% endhint %}</p>

<p spaces-before="0">{% hint style="warning" %}</p>

<p spaces-before="0">
その後の手順は、 <a href="guide-or-security-best-practices-for-a-eth2-validator-beaconchain-node.md">ベストプラクティスのセキュリティガイドが完了したことを前提としています。 </a></p>

<p spaces-before="0">🛑 <strong x-id="1">ROOT</strong> ユーザとしてプロセスを実行しないでください。 😱 
</p>

<p spaces-before="0">{% endhint %}</p>

<p spaces-before="0">Your choice of either <a href="https://www.parity.io/ethereum/"><strong x-id="1">OpenEthereum</strong></a><strong x-id="1">,</strong> <a href="https://geth.ethereum.org/"><strong x-id="1">Geth</strong></a><strong x-id="1">,</strong> <a href="https://besu.hyperledger.org/"><strong x-id="1">Besu</strong></a><strong x-id="1">,</strong> <a href="https://www.nethermind.io/"><strong x-id="1">Nethermind</strong></a> <strong x-id="1">or</strong> <a href="https://infura.io/"><strong x-id="1">Infura</strong></a><strong x-id="1">.</strong></p>

<p spaces-before="0">{% tabs %}</p>

<p spaces-before="0">
</p>

<p spaces-before="0">{% tab title="OpenEthereum \(Parity\)" %}</p>

<p spaces-before="0">
</p>

<p spaces-before="0">{% hint style="info" %}</p>

<p spaces-before="0">
<strong x-id="1">OpenEthereum</strong> - **ゴールは <strong x-id="1">Rust プログラミング言語</strong> を使用して、最速で最も軽く、最も安全なイーサリアムクライアントになることです。 OpenEthereumはGPLv3の下でライセンスされており、すべてのEthereumの必要性に使用できます。
</p>

<p spaces-before="0">{% endhint %}</p>

<h4 spaces-before="0">⚙ 依存関係のインストール</h4>

<pre><code class="text">sudo apt-get update
sudo apt-get install curl jq unzip -y
`</pre>

#### 🤖 Install OpenEthereum

最新のリリースは [https://github.com/openetherum/openetherum/releases](https://github.com/openethereum/openethereum/releases)

最新のLinuxリリース、zip解除、実行権限の追加、クリーンアップを自動的にダウンロードします。

```bash
mkdir $HOME/openethereum
cd $HOME/openethereum
curl -s https://api.github.com/repos/openethereum/openethereum/releases/latest | jq -r ".assets[] | select(.name) | .browser_download_url" | grep linux | xargs wget -q --show-progress
unzip -o openethereum*.zip
chmod +x openethereum
rm openethereum*.zip
```

<unk> ⚙ **systemdの設定と設定**

**eth1.service** の設定を定義する `ユニットファイル` を作成するには、以下を実行します。

単純に以下をコピー/ペーストします。

```bash
cat > $HOME/eth1.service << EOF 
[Unit]
Description     = openethereum eth1 service
Wants           = network-online.target
After           = network-online.target 

[Service]
User            = $(whoami)
ExecStart       = $(echo $HOME)/openethereum/openethereum --chain goerli
Restart         = on-failure
RestartSec      = 3

[Install]
WantedBy    = multi-user.target
EOF
```

{% hint style="info" %}
**Nimbus Specific Configuration**: **ExecStart** ラインに次のフラグを追加します。

```bash
--ws-origins=all
```
{% endhint %}

ユニットファイルを `/etc/systemd/system` に移動し、アクセス許可を与えます。

```bash
sudo mv $HOME/eth1.service /etc/systemd/system/eth1.service
```

```bash
sudo chmod 644 /etc/systemd/system/eth1.service
```

起動時に自動起動を有効にするには、以下を実行します。

```text
sudo systemctl daemon-reload
sudo systemctl enable eth1
```

#### ⛓ OpenEthereumを開始

```text
sudo systemctl start eth1
```
{% endtab %}

{% tab title="Geth" %}
{% hint style="info" %}
**Geth** - Go Ethereumは、Ethereumプロトコルの(C++とPythonとともに)3つの元の実装の1つです。 それは **Go**で書かれており、完全にオープンソースであり、GNU LGPL v3 の下でライセンスされています。
{% endhint %}

#### 🧬 リポジトリからインストール

```text
sudo add-apt-repository -y ppa:ethereum/ethereum
sudo apt-get update -y
sudo apt-get install ethereum -y
```

⚙ **systemdの設定と設定**

**eth1.service** の設定を定義する `ユニットファイル` を作成するには、以下を実行します。

単純に以下をコピー/ペーストします。

```bash
cat > $HOME/eth1.service << EOF 
[Unit]
Description     = geth eth1 service
Wants           = network-online.target
After           = network-online.target 

[Service]
User            = $(whoami)
ExecStart       = /usr/bin/geth --http --goerli --metrics --pprof
Restart         = on-failure
RestartSec      = 3

[Install]
WantedBy    = multi-user.target
EOF
```

{% hint style="info" %}
**Nimbus Specific Configuration**: **ExecStart** ラインに次のフラグを追加します。

```bash
--ws
```
{% endhint %}

ユニットファイルを `/etc/systemd/system` に移動し、アクセス許可を与えます。

```bash
sudo mv $HOME/eth1.service /etc/systemd/system/eth1.service
```

```bash
sudo chmod 644 /etc/systemd/system/eth1.service
```

起動時に自動起動を有効にするには、以下を実行します。

```text
sudo systemctl daemon-reload
sudo systemctl enable eth1
```

#### ⛓ 開始 geth

```text
sudo systemctl start eth1
```
{% endtab %}

{% tab title="Besu" %}
{% hint style="info" %}
**Hyperledger Besu** はオープンソースのイーサリアムクライアントで、プライベートネットワークで安全で高性能なトランザクション処理を必要とする要求の厳しいエンタープライズアプリケーション向けに設計されています。 Apache 2.0 ライセンスの下で開発され、 **Java** で書かれています。
{% endhint %}

#### 🧬 Java の依存関係をインストール

```text
sudo apt-get update
sudo apt install openjdk-11-jdk -y
```

#### 🌜 Besuをダウンロードして解凍します。

最新のリリースは [https://github.com/hyperledger/besu/releases](https://github.com/hyperledger/besu/releases)

ファイルは [https://dl.bintray.com/hyperledger-org/besu-repo からダウンロードできます](https://dl.bintray.com/hyperledger-org/besu-repo)

```text
cd
wget -O besu.tar.gz https://dl.bintray.com/hyperledger-org/besu-repo/besu-20.10.1.tar.gz
tar -xvf besu.tar.gz
rm besu.tar.gz
mv besu* besu
```

⚙ **systemdの設定と設定**

**eth1.service** の設定を定義する `ユニットファイル` を作成するには、以下を実行します。

単純に以下をコピー/ペーストします。

```bash
cat > $HOME/eth1.service << EOF 
[Unit]
Description     = besu eth1 service
Wants           = network-online.target
After           = network-online.target 

[Service]
User            = $(whoami)
ExecStart       = $(echo $HOME)/besu/bin/besu --metrics-enabled --rpc-http-enabled --network=goerli --data-path="$HOME/.besu_goerli"
Restart         = on-failure
RestartSec      = 3

[Install]
WantedBy    = multi-user.target
EOF
```

ユニットファイルを `/etc/systemd/system` に移動し、アクセス許可を与えます。

```bash
sudo mv $HOME/eth1.service /etc/systemd/system/eth1.service
```

```bash
sudo chmod 644 /etc/systemd/system/eth1.service
```

起動時に自動起動を有効にするには、以下を実行します。

```text
sudo systemctl daemon-reload
sudo systemctl enable eth1
```

#### ⛓ Start besu

```text
sudo systemctl start eth1
```
{% endtab %}

{% tab title="Nethermind" %}
{% hint style="info" %}
**Nethermind** は、パフォーマンスと柔軟性に関する主要なイーサリアムクライアントです。 Built on **.NET** core, a widespread, enterprise-friendly platform, Nethermind makes integration with existing infrastructures simple, without losing sight of stability, reliability, data integrity, and security.
{% endhint %}

#### ⚙ 依存関係のインストール

```text
sudo apt-get update
sudo apt-get install curl libsnappy-dev libc6-dev jq libc6 unzip -y
```

#### 🌜 ネザーマインドをダウンロードして解凍する

最新のリリースは [https://github.com/NethermindEth/nethermind/releases で確認してください](https://github.com/NethermindEth/nethermind/releases)

最新のLinuxリリース、ZIP解除、クリーンアップを自動的にダウンロードします。

```bash
mkdir $HOME/nethermind
chmod 775 $HOME/nethermind
cd $HOME/nethermind
curl -s https://api.github.com/repos/NethermindEth/nethermind/releases/latest | jq -r ".assets[] | select(.name) | .browser_download_url" | grep linux  | xargs wget -q --show-progress
unzip -o nethermind*.zip
rm nethermind*linux*.zip
```

⚙ **systemdの設定と設定**

**eth1.service** の設定を定義する `ユニットファイル` を作成するには、以下を実行します。

単純に以下をコピー/ペーストします。

```bash
cat > $HOME/eth1.service << EOF 
[Unit]
Description     = nethermind eth1 service
Wants           = network-online.target
After           = network-online.target 

[Service]
User            = $(whoami)
ExecStart       = $(echo $HOME)/nethermind/Nethermind.Runner --config goerli --baseDbPath $HOME/.nethermind_goerli --Metrics.Enabled true --JsonRpc.Enabled true --Sync.DownloadBodiesInFastSync true --Sync.DownloadReceiptsInFastSync true --Sync.AncientBodiesBarrier 11052984 --Sync.AncientReceiptsBarrier 11052984
Restart         = on-failure
RestartSec      = 3

[Install]
WantedBy    = multi-user.target
EOF
```

ユニットファイルを `/etc/systemd/system` に移動し、アクセス許可を与えます。

```bash
sudo mv $HOME/eth1.service /etc/systemd/system/eth1.service
```

```bash
sudo chmod 644 /etc/systemd/system/eth1.service
```

起動時に自動起動を有効にするには、以下を実行します。

```text
sudo systemctl daemon-reload
sudo systemctl enable eth1
```

#### ⛓ Start Nethermind

```text
sudo systemctl start eth1
```

{% hint style="info" %}
**Metric Error messages についての注意**: prometheus pushergateway がセクション6にセットアップされるまで、これらが表示されます。 `MetricPusherエラー: System.Net.Http.HttpRequestException: 接続が拒否されました`
{% endhint %}
{% endtab %}

{% tab title="Minimum Hardware Setup \(Infura\)" %}
{% hint style="info" %}
無限のディスク領域の設定に適しています。 可能な場合は、常に独自のフルeth1ノードを実行します。
{% endhint %}

[https://infura.io/](https://infura.io/) の API アクセスキーにサインアップ

1. 無料アカウントにサインアップします。
2. メールアドレスを確認してください。
3. ダッシュボード [https://infura.io/dashboard](https://infura.io/dashboard) をご覧ください
4. プロジェクトを作成し、名前を付けます。
5. ENDPOINTとして **Goerli** を選択する
6. 以下にあるeth2クライアントの特定の設定に従ってください。

## ニンバス特有の設定

1. システムの **ユニットファイル**を作成するときは、このエンドポイントで `--web-url` パラメータを更新します。
2. WebSocket のエンドポイントをコピーします。 `wss://` で開始
3. これをステップ4で保存し、eth2ノードを設定します。

```bash
#example
--web3-url=<your wss:// infura endpoint>
```

## 鉄工固有の構成

1. `/etc/teku/teku.yaml` にある `teku.yaml`を作成した後、このエンドポイントで `--eth1-endpoint` パラメータを更新します。
2. http エンドポイントをコピーします。 `http://`で開始
3. これをステップ4で保存し、eth2ノードを設定します。

```bash
#example
eth1-endpoint: <your https:// infura endpoint>
```

## 灯台固有の構成

1. **beacon chain systemd** **unit file**を作成するときは、このエンドポイントで `--eth1-endpoint` パラメータを追加します。
2. **https** エンドポイントをコピーします。 `https://` で始まります
3. これをステップ4で保存し、eth2ノードを設定します。

```bash
#example
--eth1-endpoint=<your https:// infura endpoint>
```

## プライズム固有の設定

1. **beacon chain systemd unit file**を作成するときは、このエンドポイントで `--http-web3provider` パラメータを更新してください。
2. **https** エンドポイントをコピーします。 `https://` で始まります
3. これをステップ4で保存し、eth2ノードを設定します。

```bash
#example
--http-web3provider=<your https:// infura endpoint>
```
{% endtab %}
{% endtabs %}

{% hint style="info" %}
eth1ノードの同期には最大1週間かかることがあります。 ギガビットインターネットを搭載したハイエンドマシンでは、同期に1日以内かかることを期待しています。
{% endhint %}

{% hint style="success" %}
eth1 ノードは、これらのイベントが発生したときに完全に同期されます。

* **`OpenEthereum:`** `Imported #<block number>`
* **`Geth:`** `新しいチェーンセグメントをインポート`
* **`Besu:`** `インポート済み #<block number>`
* **`Nethermind:`** `古いヘッダを同期しなくなりました`
{% endhint %}

#### 🛠 eth1.service commands

<unk> <unk> 🗒 **eth1ログを表示してフォローする**

```text
journalctl -u eth1 -f
```

🗒 **eth1 サービスを停止するには**

```text
sudo systemctl stop eth1
```

## 🌜 4. ETH2ビーコンチェーンノードとバリデータを設定する

Lighthouse、Nimbus、Teku、Prysm、Lodestarのいずれかをお選びください。

{% tabs %}
{% tab title="Lighthouse" %}
{% hint style="info" %}
[灯台](https://github.com/sigp/lighthouse) は Eth2.0 クライアントで、スピードとセキュリティに重点を置いています。 背後にいるチーム [シグマ・プライム](https://sigmaprime.io/), は、Ethereum財団、Consensysys、および個人とともにLighthouseに資金を提供した情報セキュリティおよびソフトウェアエンジニアリング会社です。 LighthouseはRustに構築され、Apache 2.0ライセンスの下で提供されています。
{% endhint %}

## ⚙ 4.1. Rust の依存関係をインストール

```bash
curl --proto '=https' --tlsv1.2 -sSF https://sh.rustup.rs | sh
```

デフォルトのインストールを続行するには'1'を入力してください。

環境変数を更新します。

```bash
echo export PATH="$HOME/.cargo/bin:$PATH" >> ~/.bashrc
source ~/.bashrc
```

錆の依存関係をインストールします。

```text
sudo apt install -y git gcc g++ make cmake pkg-config libssl-dev
```

## 💡 4.2. ソースから灯台を作る

```bash
mkdir ~/git
cd ~/git
git clone https://github.com/sigp/lighthouse.git
cd lighthouse
git fetch --all && git checkout stable && git pull
make
```

{% hint style="info" %}
コンパイルエラーの場合は、次のシーケンスを実行します。

```text
rustup update
cargo clean
make
```
{% endhint %}

{% hint style="info" %}
このビルドプロセスには数分かかることがあります。
{% endhint %}

バージョン番号を確認して灯台が正しくインストールされていることを確認します。

```text
lighouse --version
```

## 🎩 4.3. バリデータキーをインポート

{% hint style="info" %}
Lighthouseにキーをインポートすると、バリデータ署名キー\(s\)は `$HOME/.lightouse/prymont/validators` フォルダに保存されます。
{% endhint %}

以下のコマンドを実行して、validator キーを eth2deposit-cli ツールディレクトリからインポートします。

**キーストアのパスワード** を入力してアカウントをインポートします。

```bash
灯台アカウントのバリデータのインポート --network pyrmont --directory=$HOME/eth2deposit-cli/validator_keys
```

アカウントが正常にインポートされたことを確認します。

```bash
灯台account_manager バリデータリスト --network pyrmont
```

{% hint style="danger" %}
**警告**: 他のリンクを有効にするためには、元のキーを使用しないでください。さもないと、SLASHEDを取得します。
{% endhint %}

## 🔥 4.4. ポート転送やファイアウォールの設定

ネットワーク設定またはクラウドプロバイダ設定に固有の [バリデータのファイアウォールポートがオープンで到達可能であることを確認してください。](guide-or-security-best-practices-for-a-eth2-validator-beaconchain-node.md#configure-your-firewall)

* **灯台ビーコンチェーン** は、tcpとudpのためにポート9000が必要
* **eth1** 節点は、tcpとudp のポート30303が必要です

{% hint style="info" %}
✨ **ポート転送 ヒント:** ポートをバリデータに転送して開く必要があります。 [https://www.yougetsignal.com/tools/open-ports/](https://www.yougetsignal.com/tools/open-ports/) または [https://canyouseeme.org/](https://canyouseeme.org/) で動作していることを確認してください。
{% endhint %}

## ⛓ 4.5. ビーコンチェーンを開始する

#### 🍰 ビーコンチェーンにsystemdを使用する利点 <a id="benefits-of-using-systemd-for-your-stake-pool"></a>

1. メンテナンス、停電などによるコンピュータの再起動時にビーコンチェーンを自動起動します。
2. クラッシュしたビーコンチェーンプロセスを自動的に再起動します。
3. ビーコンチェーンの稼働時間とパフォーマンスを最大化します。

#### 🛠 セットアップ手順

**beacon-chain.service** の設定を定義するために、次のように`ユニットファイル` を作成します。

```bash
cat > $HOME/beacon-chain.service << EOF 
# The eth2 beacon chain service (part of systemd)
# file: /etc/systemd/system/beacon-chain.service 

[Unit]
Description     = eth2 beacon chain service
Wants           = network-online.target
After           = network-online.target 

[Service]
User            = $(whoami)
ExecStart       = $(which lighthouse) bn --staking --metrics --network pyrmont
Restart         = on-failure

[Install]
WantedBy    = multi-user.target
EOF
```

{% hint style="info" %}
\*\*\*🔥 **Lighthouse Pro ヒント:** **ExecStart** 行で `--eth1-endpoints` フラグを追加すると、冗長な eth1 ノードが使用できます。 カンマで区切ってください。 エンドポイントが末尾のスラッシュで終わらないこと、または`/` それを削除してください。

```bash
# 例:
--eth1-endpoints http://localhost:8545,https://nodes.mewapi.io/rpc/eth,https://mainnet.eth.cloud.ava.do,https://mainnet.infura.io/v3/xxx
```

💸 [https://ethereumnodes.com/](https://ethereumnodes.com/) で無料の ethereum fallback nodes を見つけます。
{% endhint %}

ユニットファイルを `/etc/systemd/system に移動します`

```bash
sudo mv $HOME/beacon-chain.service /etc/systemd/system/beacon-chain.service
```

アクセス許可を与えます。

```bash
sudo chmod 644 /etc/systemd/system/beacon-chain.service
```

起動時に自動起動を有効にし、ビーコンノードサービスを開始するには、以下を実行します。

```text
sudo systemctl daemon-reload
sudo systemctl enable beacon-chain
sudo systemctl start beacon-chain
```

{% hint style="success" %}
よくやった。 あなたのビーコンチェーンは、システムの信頼性と堅牢性によって管理されています。 systemdを使用するためのコマンドを以下に示します。
{% endhint %}

### 🛠 systemd コマンドをいくつか使います。

#### ✅ビーコンチェーンがアクティブかどうかを確認します

```text
sudo systemctl is-active beacon-chain
```

#### 🔎 ビーコンチェーンの状態を表示

```text
sudo systemctl status beacon-chain
```

#### 🔄 ビーコンチェーンを再起動する

```text
sudo systemctl reload-or-restart beacon-chain
```

#### 🛑 ビーコンチェーンを停止します

```text
sudo systemctl stop beacon-chain
```

#### :file_cabiet: ログの表示とフィルタリングを行う

```bash
#view and follow the log
journalctl --unit=beacon-chain -f
#view log since yesterday
journctl --unit=beacon-chain ---since=today
#view log since today
journalctl --unit=beacon-chain ---since=today
#view log between a date
journctl ----unit=beacon-chain --since='202020-12-02 12:00:00:00' -since='20202020-12-02 12:00:00:00'
```

{% hint style="info" %}
`--metrics` フラグは、ポート5054のレポートを有効にし、Prometheusで監視します。
{% endhint %}

## 🧬 4.6. バリデータを開始する

systemdで自動的にバリデータを実行します。

#### 🍰 バリデータに systemd を使用する利点 <a id="benefits-of-using-systemd-for-your-stake-pool"></a>

1. メンテナンス、停電などによりコンピュータが再起動すると、バリデータを自動的に開始します。
2. クラッシュしたバリデータプロセスを自動的に再起動します。
3. バリデータの稼働時間とパフォーマンスを最大化します。

#### 🛠 セットアップ手順

**validator.service** の設定を定義する`ユニットファイル` を作成するには、以下を実行します。

```bash
cat > $HOME/validator.service << EOF 
# The eth2 validator service (part of systemd)
# file: /etc/systemd/system/validator.service 

[Unit]
Description     = eth2 validator service
Wants           = network-online.target beacon-chain.service
After           = network-online.target 

[Service]
User            = $(whoami)
ExecStart       = $(which lighthouse) vc --network pyrmont --metrics
Restart         = on-failure

[Install]
WantedBy    = multi-user.target
EOF
```

ユニットファイルを `/etc/systemd/system` に移動し、アクセス許可を与えます。

```bash
sudo mv $HOME/validator.service /etc/systemd/system/validator.service
sudo chmod 644 /etc/systemd/system/validator.service
```

起動時に自動起動を有効にし、バリデータを開始するには、以下を実行します。

```text
sudo systemctl daemon-reload
sudo systemctl enable validator
sudo systemctl start validator
```

{% hint style="success" %}
よくやった。 現在、バリデータはシステムの信頼性と堅牢性によって管理されています。 systemdを使用するためのコマンドを以下に示します。
{% endhint %}

### 🛠 systemd コマンドをいくつか使います。

#### ✅バリデータが有効かどうかを確認します

```text
sudo systemctl is-active validator
```

#### 🔎 バリデータの状態を表示

```text
sudo systemctl status validator
```

#### 🔄 バリデータを再起動する

```text
sudo systemctl reload-or-restart validator
```

#### 🛑 バリデータの停止

```text
sudo systemctl stop validator
```

#### :file_cabiet: ログの表示とフィルタリングを行う

```bash
#view and follow the log
journalctl --unit=validator -f
#view log since yesterday
journctl --unit=validator --since=today
#view log since today
journalctl --unit=validator --since=today
#view log between a date
journctl ---unit=validator --since='202020-12-01 00-01 00:00:00' -until='20202020-12-02 12:00:00:00:00:00'
```
{% endtab %}

{% tab title="Nimbus" %}
{% hint style="info" %}
[Nimbus](https://our.status.im/tag/nimbus/) は、イーサリアム2の研究プロジェクトとクライアント実装です。 リソースに制限がある古いスマートフォンを含む、組込みシステムやパーソナルモバイルデバイスでうまく動作するように設計されています。 Nimbusチームは [ステータス](https://status.im/about/) の出身で、 [メッセージングapp/wallet/Web3ブラウザ](https://status.im/) で最もよく知られています。 Nimbus \(Apache 2\) は C にコンパイルする Python のような構文を持つ言語である Nimで書かれています。
{% endhint %}

## ⚙ 4.1. ソースから Nimbus をビルド

依存関係のインストール

```text
sudo apt-get update
sudo apt-get install curl build-essential git -y
```

Nimbus をインストールしてビルドします。

```bash
mkdir ~/git 
cd ~/git
git clone https://github.com/status-im/imbus-eth2
cd nimbus-eth2
make NIMFLAGS="-d:insecure" nimbus_beacon_node
```

{% hint style="info" %}
ビルドプロセスには数分かかることがあります。
{% endhint %}

ヘルプを表示してNimbusが正しくインストールされていることを確認します。

```bash
cd $HOME/git/nimbus-eth2/build
./nimbus_beacon_node --help
```

バイナリファイルを `/usr/bin` にコピーします

```bash
sudo cp $HOME/git/nimbus-eth2/build/nimbus_beacon_node /usr/bin
```

## 🎩 4.2. バリデータキーをインポート <a id="6-import-validator-key"></a>

ニンバスデータを格納するディレクトリ構造を作成します。

```bash
sudo mkdir -p /var/lib/nimbus
```

このディレクトリの所有権を取得し、正しい権限レベルを設定します。

```bash
sudo chown $(whoami):$(whoami) /var/lib/nimbus
sudo chmod 700 /var/lib/nimbus
```

以下のコマンドはバリデータキーをインポートします。

**キーストアのパスワード** を入力してアカウントをインポートします。

```bash
cd $HOME/git/nimbus-eth2
build/nimbus_beacon_node depositions import --data-dir=/var/lib/nimbus $HOME/eth2depositit-cli/validator_keys
```

これで、ディレクトリ一覧を行うことでアカウントが正常にインポートされたことを確認できます。

```bash
ll /var/lib/nimbus/validators
```

それぞれのバリデータのpubkeyにちなんで名付けられたフォルダが表示されます。

{% hint style="info" %}
When you import your keys into Nimbus, your validator signing key\(s\) are stored in the `/var/lib/nimbus` folder, under `secrets` and `validators.`

`secrets` フォルダには、すべてのバリデータキーにアクセスできる共通の秘密が含まれています。

`バリデータ` フォルダには、署名する keystore\(s\) \(暗号化された鍵\) が含まれています。 キーストアは、キーを交換するためのメソッドとしてバリデータによって使用されます。

キーとキーストアの詳細については、こちら [](https://blog.ethereum.org/2020/05/21/keys/) を参照してください。
{% endhint %}

{% hint style="danger" %}
**警告**: 他のリンクを有効にするためには、元のキーを使用しないでください。さもないと、SLASHEDを取得します。
{% endhint %}

## 🔥 4.3. ポート転送やファイアウォールの設定

ネットワーク設定またはクラウドプロバイダ設定に固有の [バリデータのファイアウォールポートがオープンで到達可能であることを確認してください。](guide-or-security-best-practices-for-a-eth2-validator-beaconchain-node.md#configure-your-firewall)

* **Nimbus beacon chain node** will use port 9000 for tcp.
* **eth1** 節点は、tcpとudp のポート30303が必要です

{% hint style="info" %}
✨ **ポート転送 ヒント:** ポートをバリデータに転送して開く必要があります。 [https://www.yougetsignal.com/tools/open-ports/](https://www.yougetsignal.com/tools/open-ports/) または [https://canyouseeme.org/](https://canyouseeme.org/) で動作していることを確認してください。
{% endhint %}

## 🏂 4.4. ビーコンチェーンとバリデータを開始する

{% hint style="info" %}
Nimbusはビーコンチェーンとバリデータの両方を1つのプロセスに統合します。
{% endhint %}

自動的にビーコンチェーンとバリデータをシステムdで実行します。

#### 🍰 あなたのビーコンチェーンとバリデータに systemd を使用する利点 <a id="benefits-of-using-systemd-for-your-stake-pool"></a>

1. メンテナンス、停電などによるコンピュータの再起動時にビーコンチェーンを自動起動します。
2. クラッシュしたビーコンチェーンプロセスを自動的に再起動します。
3. ビーコンチェーンの稼働時間とパフォーマンスを最大化します。

#### 🛠 セットアップ手順

**beacon-chain.service** の設定を定義するために、次のように`ユニットファイル` を作成します。

```bash
cat > $HOME/beacon-chain.service << EOF 
# The eth2 beacon chain service (part of systemd)
# file: /etc/systemd/system/beacon-chain.service 

[Unit]
Description     = eth2 beacon chain service
Wants           = network-online.target
After           = network-online.target 

[Service]
Type            = simple
User            = $(whoami)
WorkingDirectory= /var/lib/nimbus
ExecStart       = /usr/bin/nimbus_beacon_node --network=pyrmont --data-dir=/var/lib/nimbus --web3-url=ws://127.0.0.1:8546 --metrics --metrics-port=8008 --rpc --rpc-port=9091 --validators-dir=/var/lib/nimbus/validators --secrets-dir=/var/lib/nimbus/secrets --log-file=/var/lib/nimbus/beacon.log
Restart         = on-failure

[Install]
WantedBy    = multi-user.target
EOF
```

{% hint style="warning" %}
Nimbus は ETH1 ノードの websocket 接続 \("ws://" と "wss://"\' のみをサポートしています。 Geth, OpenEthereum, Infura ETH1ノードの互換性が検証されています。
{% endhint %}

ユニットファイルを `/etc/systemd/system に移動します`

```bash
sudo mv $HOME/beacon-chain.service /etc/systemd/system/beacon-chain.service
```

ファイル権限を更新します。

```bash
sudo chmod 644 /etc/systemd/system/beacon-chain.service
```

起動時に自動起動を有効にし、ビーコンノードサービスを開始するには、以下を実行します。

```text
sudo systemctl daemon-reload
sudo systemctl enable beacon-chain
sudo systemctl start beacon-chain
```

{% hint style="success" %}
よくやった。 あなたのビーコンチェーンは、システムの信頼性と堅牢性によって管理されています。 systemdを使用するためのコマンドを以下に示します。
{% endhint %}

### 🛠 systemd コマンドをいくつか使います。

#### ✅ビーコンチェーンがアクティブかどうかを確認します

```text
sudo systemctl is-active beacon-chain
```

#### 🔎 ビーコンチェーンの状態を表示

```text
sudo systemctl status beacon-chain
```

#### 🔄 ビーコンチェーンを再起動する

```text
sudo systemctl reload-or-restart beacon-chain
```

#### 🛑 ビーコンチェーンを停止します

```text
sudo systemctl stop beacon-chain
```

#### :file_cabiet: ログの表示とフィルタリングを行う

```bash
#view and follow the log
journalctl --unit=beacon-chain -f
#view log since yesterday
journctl --unit=beacon-chain ---since=today
#view log since today
journalctl --unit=beacon-chain ---since=today
#view log between a date
journctl ----unit=beacon-chain --since='202020-12-02 12:00:00:00' -since='20202020-12-02 12:00:00:00'
```
{% endtab %}

{% tab title="Teku" %}
{% hint style="info" %}
[PegaSys Teku](https://pegasys.tech/teku/) \(旧 Artemis\)は、制度的なニーズとセキュリティ要件を満たすように設計されたJavaベースのEthereum 2.0クライアントです。 & PegaSys は [ConsenSys](https://consensys.net/) の部門であり、エンタープライズ対応のクライアントとコアイーサリアムプラットフォームとやり取りするためのツールを構築することに専念しています。 Teku is Apache 2 licensed and written in Java, a language notable for its materity & ubiquity.
{% endhint %}

## ⚙ 4.1 ソースからTekuをビルド

Install git.

```text
sudo apt-get install git -y
```

Java 11をインストールします。

**Ubuntu 20.x**の場合、以下を使用してください

```
sudo apt update
sudo apt install openjdk-11-jdk -y
```

**Ubuntu 18.x**の場合、以下を使用してください

```text
sudo add-apt-repository ppa:linuxuprising/java
sudo apt update
sudo apt install oracle-java11-set-default -y
```

Java 11以降がインストールされていることを確認します。

```bash
Java --version
```

Tekuをインストールしてビルドします。

```bash
mkdir ~/git
cd ~/git
git clone https://github.com/ConsenSys/teku.git
cd teku
./gradlew distTar installDist
```

{% hint style="info" %}
このビルドプロセスには数分かかることがあります。
{% endhint %}

バージョンを表示することでTekuが正しくインストールされていることを確認します。

```bash
cd $HOME/git/teku/build/install/teku/bin
./teku -version
```

tekuバイナリファイルを `/usr/bin/teku`にコピーします

```bash
sudo cp -r $HOME/git/teku/build/install/teku /usr/bin/teku
```

## 🔥 4.2. ポート転送やファイアウォールの設定

ネットワーク設定またはクラウドプロバイダ設定に固有の [バリデータのファイアウォールポートがオープンで到達可能であることを確認してください。](guide-or-security-best-practices-for-a-eth2-validator-beaconchain-node.md#configure-your-firewall)

* **Tekuビーコンチェーンノード** はポート9000をtcpとudpに使用します
* **eth1** 節点は、tcpとudp のポート30303が必要です

{% hint style="info" %}
\*\*\*✨ **ポート転送のヒント:** ポートをバリデータに転送して開く必要があります。 [https://www.yougetsignal.com/tools/open-ports/](https://www.yougetsignal.com/tools/open-ports/) または [https://canyouseeme.org/](https://canyouseeme.org/) で動作していることを確認してください。
{% endhint %}

## 🏂 4.3. ビーコンチェーンとバリデータを設定する

{% hint style="info" %}
Tekuはビーコンチェーンとバリデータの両方を1つのプロセスに統合します。
{% endhint %}

{% hint style="warning" %}
以前のテストネットに参加した場合は、データベースをクリアする必要があります。

```bash
rm -rf $HOME/.local/share/teku/data
```
{% endhint %}

鉄工用のディレクトリ構造を設定します。

```bash
sudo mkdir -p /var/lib/teku
sudo mkdir -p /etc/teku
sudo chown $(whoami):$(whoami) /var/lib/teku
```

 `validator_files` ディレクトリを上記で作成したデータディレクトリにコピーし、余分なデポジット\_dataファイルを削除します。

```bash
cp -r $HOME/eth2deposit-cli/validator_keys /var/lib/teku
rm /var/lib/teku/validator_keys/deposit_data*
```

{% hint style="danger" %}
**警告**: 他のリンクを有効にするためには、元のキーを使用しないでください。さもないと、SLASHEDを取得します。
{% endhint %}

**キーストアのパスワード** をファイルに保存し、読み取り専用にします。 Tekuがバリデータを復号してロードできるようにするには、これが必要です。

**echo** の後に引用符間の `キーストアのパスワード` を更新します。

```bash
echo 'my_keystore_password' > $HOME/validators-password.txt
sudo mv $HOME/validators-password.txt /etc/teku/validators-password.txt
sudo chmod 600 /etc/teku/validators-password.txt
```

キーストアパスワードの痕跡を削除するには、bash 履歴をクリアします。

```bash
shred -u ~/.bash_history && touch ~/.bash_history
```

Teku設定ファイルを生成します。

```bash
cat > $HOME/teku.yaml << EOF
# network
network: "pyrmont"

# p2p
p2p-enabled: true
p2p-port: 9000
# validators
validator-keys: "/var/lib/teku/validator_keys:/var/lib/teku/validator_keys"
validators-graffiti: "Teku validator & CoinCashew.com"

# Eth 1
eth1-endpoint: "http://localhost:8545"

# metrics
metrics-enabled: true
metrics-port: 8008

# database
data-path: "$(echo $HOME)/tekudata"
data-storage-mode: "archive"

# rest api
rest-api-port: 5051
rest-api-docs-enabled: true
rest-api-enabled: true

# logging
log-include-validator-duties-enabled: true
log-destination: CONSOLE
EOF
```

設定ファイルを `/etc/teku`に移動する

```bash
sudo mv $HOME/teku.yaml /etc/teku/teku.yaml
```

## 🎩 4.4 インポートバリデータキー

{% hint style="info" %}
バリデータキーのディレクトリを指定する場合、Tekuは同じ名前のキーストアとパスワードファイルを見つけることを期待します。

例えば `keystore-m_12221_3600_1_0_11222333.json` と `keystore-m_12221_3600_1_0_11222333.txt`
{% endhint %}

すべてのバリデータに対応するパスワードファイルを作成します。

```bash
for f in /var/lib/teku/validator_keys/keystore*.json; do cp /etc/teku/validators-password.txt /var/lib/teku/validator_keys/$(basename $f .json).txt
```

バリデータのキーストアとバリデータのパスワードが存在することを確認するには、以下のディレクトリを確認します。

```bash
ll /var/lib/teku/validator_keys
```

## 🏁 4.5. ビーコンチェーンとバリデータを開始する

**systemd** を使用して、tekuの開始と停止を管理します。

#### 🍰 あなたのビーコンチェーンとバリデータに systemd を使用する利点 <a id="benefits-of-using-systemd-for-your-stake-pool"></a>

1. メンテナンス、停電などによるコンピュータの再起動時にビーコンチェーンを自動起動します。
2. クラッシュしたビーコンチェーンプロセスを自動的に再起動します。
3. ビーコンチェーンの稼働時間とパフォーマンスを最大化します。

#### 🛠 セットアップ手順

**beacon-chain.service** の設定を定義するために、次のように`ユニットファイル` を作成します。

```bash
cat > $HOME/beacon-chain.service << EOF
# The eth2 beacon chain service (part of systemd)
# file: /etc/systemd/system/beacon-chain.service 

[Unit]
Description     = eth2 beacon chain service
Wants           = network-online.target
After           = network-online.target 

[Service]
User            = $(whoami)
ExecStart       = /usr/bin/teku/bin/teku -c /etc/teku/teku.yaml
Restart         = on-failure
Environment     = JAVA_OPTS=-Xmx5g

[Install]
WantedBy    = multi-user.target
EOF
```

ユニットファイルを `/etc/systemd/system` に移動し、アクセス許可を与えます。

```bash
sudo mv $HOME/beacon-chain.service /etc/systemd/system/beacon-chain.service
sudo chmod 644 /etc/systemd/system/beacon-chain.service
```

起動時に自動起動を有効にし、ビーコンノードサービスを開始するには、以下を実行します。

```text
sudo systemctl daemon-reload
sudo systemctl enable beacon-chain
sudo systemctl start beacon-chain
```

{% hint style="success" %}
よくやった。 あなたのビーコンチェーンは、システムの信頼性と堅牢性によって管理されています。 systemdを使用するためのコマンドを以下に示します。
{% endhint %}

### 🛠 systemd コマンドをいくつか使います。

#### ✅ビーコンチェーンがアクティブかどうかを確認します

```text
sudo systemctl is-active beacon-chain
```

#### 🔎 ビーコンチェーンの状態を表示

```text
sudo systemctl status beacon-chain
```

#### 🔄 ビーコンチェーンを再起動する

```text
sudo systemctl reload-or-restart beacon-chain
```

#### 🛑 ビーコンチェーンを停止します

```text
sudo systemctl stop beacon-chain
```

#### :file_cabiet: ログの表示とフィルタリングを行う

```bash
#view and follow the log
journalctl --unit=beacon-chain -f
#view log since yesterday
journctl --unit=beacon-chain ---since=today
#view log since today
journalctl --unit=beacon-chain ---since=today
#view log between a date
journctl ----unit=beacon-chain --since='202020-12-02 12:00:00:00' -since='20202020-12-02 12:00:00:00'
```
{% endtab %}

{% tab title="Prysm" %}
{% hint style="info" %}
[Prysm](https://github.com/prysmaticlabs/prysm) は、使いやすさ、セキュリティ、および信頼性に焦点を当てた、Ethereum 2.0プロトコルのGo実装です。 Prysmは、クライアントの開発に唯一の焦点を当てている [Prysmatic Labs](https://prysmaticlabs.com/)によって開発されました。 PrismはGoに書かれており、GPL-3.0ライセンスの下でリリースされています。
{% endhint %}

## ⚙ 4.1. Install Prysm

```bash
mkdir ~/prysm && cd ~/prysm 
curl https://raw.githubusercontent.com/prysmaticlabs/prysm/master/prysm.sh --output prysm.sh && chmod +x prysm.sh 
```

## 🔥 4.2. ポート転送やファイアウォールの設定

ネットワーク設定またはクラウドプロバイダ設定に固有の [バリデータのファイアウォールポートがオープンで到達可能であることを確認してください。](guide-or-security-best-practices-for-a-eth2-validator-beaconchain-node.md#configure-your-firewall)

* **Prysm beacon chain node** は udp にポート 12000 を tcp に使用する
* **eth1** 節点は、tcpとudp のポート30303が必要です

{% hint style="info" %}
✨ **ポート転送 ヒント:** ポートをバリデータに転送して開く必要があります。 [https://www.yougetsignal.com/tools/open-ports/](https://www.yougetsignal.com/tools/open-ports/) または [https://canyouseeme.org/](https://canyouseeme.org/) で動作していることを確認してください。
{% endhint %}

## 🎩 4.3. バリデータキーをインポート

利用規約に同意し、既定のウォレットの場所に同意する ローカルのプライズムウォレットを暗号化し、インポートされたアカウントの **キーストアのパスワード** を入力するには、新しいプライズムのみの新しいパスワードを入力してください。

{% hint style="info" %}
必要に応じて、 **keystore** と **prysm** に同じパスワードを使用できます。
{% endhint %}

```bash
$HOME/prysm/prysm.sh バリデータアカウントのインポート --pyrmont -keys-dir=$HOME/eth2deposit-cli/validator_keys
```

インポートされたバリデータの確認に成功しました。

```bash
$HOME/prysm/prysm.sh バリデータアカウントリスト --pyrmont     
```

バリデータのパブキーがリストされていることを確認します。

> \#出力例:
> 
> 1つのバリデータアカウントを表示する \`validator accounts list --show-deposit-data を実行して、アカウントの eth1 デポジットトランザクションデータを表示する
> 
> Account 0 \| pens-brother-heat   
> \[validating public key\] 0x2374.....7121

{% hint style="danger" %}
**警告**: 他のリンクを有効にするためには、元のキーを使用しないでください。さもないと、SLASHEDを取得します。
{% endhint %}

## 🏂 4.4. ビーコンチェーンを開始する

#### 🍰 あなたのビーコンチェーンとバリデータに systemd を使用する利点 <a id="benefits-of-using-systemd-for-your-stake-pool"></a>

1. メンテナンス、停電などによるコンピュータの再起動時にビーコンチェーンを自動起動します。
2. クラッシュしたビーコンチェーンプロセスを自動的に再起動します。
3. ビーコンチェーンの稼働時間とパフォーマンスを最大化します。

#### 🛠 セットアップ手順

**beacon-chain.service** の設定を定義するために、次のように`ユニットファイル` を作成します。

```bash
cat > $HOME/beacon-chain.service << EOF 
# The eth2 beacon chain service (part of systemd)
# file: /etc/systemd/system/beacon-chain.service 

[Unit]
Description     = eth2 beacon chain service
Wants           = network-online.target
After           = network-online.target 

[Service]
Type            = simple
User            = $(whoami)
ExecStart       = $(echo $HOME)/prysm/prysm.sh beacon-chain --pyrmont --p2p-max-peers=75 --monitoring-host="0.0.0.0" --http-web3provider=http://127.0.0.1:8545 --accept-terms-of-use 
Restart         = on-failure

[Install]
WantedBy    = multi-user.target
EOF
```

{% hint style="info" %}
🔥 **Prysm Pro Tip:** On the **ExecStart** line, adding the `--fallback-web3provider` flag allows for a backup eth1 node. フラグを複数回繰り返すことができます。 エンドポイントが末尾のスラッシュで終わらないこと、または`/` それを削除してください。

```bash
--fallback-web3provider=<http://<alternate eth1 provider one> --fallback-web3provider=<http://<alternate eth1 provider two>
# 例, multiple eth1 providers
# --fallback-web3provider=https://nodes.mewapi.io/rpc/eth --fallback-web3provider=https://mainnet.infura.io/v3/YOUR-PROJECT-ID
```

💸 [https://ethereumnodes.com/](https://ethereumnodes.com/) で無料の ethereum fallback nodes を見つけます。
{% endhint %}

ユニットファイルを `/etc/systemd/system に移動します`

```bash
sudo mv $HOME/beacon-chain.service /etc/systemd/system/beacon-chain.service
```

アクセス許可を与えます。

```bash
sudo chmod 644 /etc/systemd/system/beacon-chain.service
```

起動時に自動起動を有効にし、ビーコンノードサービスを開始するには、以下を実行します。

```text
sudo systemctl daemon-reload
sudo systemctl enable beacon-chain
sudo systemctl start beacon-chain
```

{% hint style="success" %}
よくやった。 あなたのビーコンチェーンは、システムの信頼性と堅牢性によって管理されています。 systemdを使用するためのコマンドを以下に示します。
{% endhint %}

### 🛠 systemd コマンドをいくつか使います。

#### ✅ビーコンチェーンがアクティブかどうかを確認します

```text
sudo systemctl is-active beacon-chain
```

#### 🔎 ビーコンチェーンの状態を表示

```text
sudo systemctl status beacon-chain
```

#### 🔄 ビーコンチェーンを再起動する

```text
sudo systemctl reload-or-restart beacon-chain
```

#### 🛑 ビーコンチェーンを停止します

```text
sudo systemctl stop beacon-chain
```

#### 🗒 ログを表示およびフィルタリングする

```bash
#view and follow the log
journalctl --unit=beacon-chain -f
#view log since yesterday
journctl --unit=beacon-chain ---since=today
#view log since today
journalctl --unit=beacon-chain ---since=today
#view log between a date
journctl ----unit=beacon-chain --since='202020-12-02 12:00:00:00' -since='20202020-12-02 12:00:00:00'
```

## 🧬 4.5. バリデータを開始する <a id="9-start-the-validator"></a>

**prysm パスワード** をファイルに保存し、読み取り専用にします。 プリズムがバリデータを復号してロードできるようにするには、これが必要です。

```bash
echo 'my_password_goes_here' > $HOME/.eth2validators/validators-password.txt
sudo chmod 600 $HOME/.eth2validators/validators-password.txt
```

キーストアパスワードの痕跡を削除するには、bash 履歴をクリアします。

```bash
shred -u ~/.bash_history && touch ~/.bash_history
```

コマンドラインから手動で、またはsystemdで自動的にバリデータを実行することができます。

#### 🍰 バリデータに systemd を使用する利点 <a id="benefits-of-using-systemd-for-your-stake-pool"></a>

1. メンテナンス、停電などによりコンピュータが再起動すると、バリデータを自動的に開始します。
2. クラッシュしたバリデータプロセスを自動的に再起動します。
3. バリデータの稼働時間とパフォーマンスを最大化します。

#### 🛠 セットアップ手順

**validator.service** の設定を定義する`ユニットファイル` を作成するには、以下を実行します。

```bash
cat > $HOME/validator.service << EOF 
# The eth2 validator service (part of systemd)
# file: /etc/systemd/system/validator.service 

[Unit]
Description     = eth2 validator service
Wants           = network-online.target beacon-chain.service
After           = network-online.target 

[Service]
User            = $(whoami)
ExecStart       = $(echo $HOME)/prysm/prysm.sh validator --pyrmont --accept-terms-of-use --wallet-password-file $(echo $HOME)/.eth2validators/validators-password.txt
Restart         = on-failure

[Install]
WantedBy    = multi-user.target
EOF
```

ユニットファイルを `/etc/systemd/system` に移動し、アクセス許可を与えます。

```bash
sudo mv $HOME/validator.service /etc/systemd/system/validator.service
sudo chmod 644 /etc/systemd/system/validator.service
```

起動時に自動起動を有効にし、バリデータを開始するには、以下を実行します。

```text
sudo systemctl daemon-reload
sudo systemctl enable validator
sudo systemctl start validator
```

### 🛠 systemd コマンドをいくつか使います。

#### ✅バリデータが有効かどうかを確認します

```text
sudo systemctl is-active validator
```

#### 🔎 バリデータの状態を表示

```text
sudo systemctl status validator
```

#### 🔄 バリデータを再起動する

```text
sudo systemctl reload-or-restart validator
```

#### 🛑 バリデータの停止

```text
sudo systemctl stop validator
```

#### :file_cabiet: ログの表示とフィルタリングを行う

```bash
#view and follow the log
journalctl --unit=validator -f
#view log since yesterday
journctl --unit=validator --since=today
#view log since today
journalctl --unit=validator --since=today
#view log between a date
journctl ---unit=validator --since='202020-12-01 00-01 00:00:00' -until='20202020-12-02 12:00:00:00:00:00'
```

**バリデータ公開キー** がログに表示されることを確認します。 以下の例：

```text
INFO Enabled validator voting_pubkey: 0x2374.....7121
```
{% endtab %}

{% tab title="Lodestar" %}
{% hint style="info" %}
**Lodestar is a Typescript implementation** of the official [Ethereum 2.0 specification](https://github.com/ethereum/eth2.0-specs) by the [ChainSafe.io](https://lodestar.chainsafe.io/) team. ビーコンチェーンクライアントに加えて、チームは22のパッケージとライブラリにも取り組んでいます。 完全なリストは [こちら](https://hackmd.io/CcsWTnvRS_eiLUajr3gi9g) にあります。 最後に ロデスタチームは、軽いクライアントの研究開発においてEth2スペースを率いており、この目的のためにEFとMoloch DAOから資金を受けています。
{% endhint %}

{% hint style="danger" %}
ロデスタはまだ完全に機能し、安定していない可能性があります。
{% endhint %}

## ⚙ 4.1 ソースからロデスタを作る

curl と git をインストールします。

```bash
sudo apt-get install git curl -y
```

yarnをインストールします。

```bash
curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | sudo apt-key add -
echo "deb https://dl.yarnpkg.com/debian/ stable main" | sudo tee /etc/apt/sources.list.d/yarn.list
sudo apt update
sudo apt install yarn
```

yarn が正しくインストールされていることを確認します。

```bash
yarn --version
# バージョンを出力する必要がある >= 1.22.4
```

Install nodejs.

```text
curl -sL https://deb.nodesource.com/setup_12.x | sudo -E bash -
sudo apt-get install -y nodejs
```

nodejsが正しくインストールされていることを確認します。

```bash
nodejs -v
# バージョンを出力する必要がある >= v12.18.3
```

Lodestarをインストールしてビルドします。

```bash
cd ~/git
git clone https://github.com/chainsafe/lodestar.git
cd lodestar
yarn install
yarn run build
```

{% hint style="info" %}
このビルドプロセスには数分かかることがあります。
{% endhint %}

ヘルプメニューを表示してロデスタが正しくインストールされていることを確認します。

```text
yarn run cli --help
```

## 🔥 4.2. ポート転送やファイアウォールの設定

ネットワーク設定またはクラウドプロバイダ設定に固有の [バリデータのファイアウォールポートがオープンで到達可能であることを確認してください。](guide-or-security-best-practices-for-a-eth2-validator-beaconchain-node.md#configure-your-firewall)

* **Lodestar beacon chain node** は、tcpにポート30607、udp peer discoveryにポート9000を使用します。
* **eth1** 節点は、tcpとudp のポート30303が必要です

{% hint style="info" %}
\*\*\*✨ **ポート転送のヒント:** ポートをバリデータに転送して開く必要があります。 [https://www.yougetsignal.com/tools/open-ports/](https://www.yougetsignal.com/tools/open-ports/) または [https://canyouseeme.org/](https://canyouseeme.org/) で動作していることを確認してください。
{% endhint %}

## 🎩 4.3. バリデータキーをインポート

```bash
yarn run cli account validator import \
  --testnet pyrmont \
  --directory $HOME/eth2deposit-cli/validator_keys
```

**キーストアのパスワード** を入力してアカウントをインポートします。

キーが正しくインポートされたことを確認します。

```text
yarn run cli account validator list --testnet pyrmont
```

{% hint style="danger" %}
**警告**: 他のリンクを有効にするためには、元のキーを使用しないでください。さもないと、SLASHEDを取得します。
{% endhint %}

## 🏂 4.4. ビーコンチェーンとバリデータを開始する

システムでビーコンチェーンを自動的に実行します。

#### 🍰 ビーコンチェーンにsystemdを使用する利点 <a id="benefits-of-using-systemd-for-your-stake-pool"></a>

1. メンテナンス、停電などによるコンピュータの再起動時にビーコンチェーンを自動起動します。
2. クラッシュしたビーコンチェーンプロセスを自動的に再起動します。
3. ビーコンチェーンの稼働時間とパフォーマンスを最大化します。

#### 🛠 セットアップ手順

**beacon-chain.service** の設定を定義するために、次のように`ユニットファイル` を作成します。

```bash
cat > $HOME/beacon-chain.service << EOF 
# The eth2 beacon chain service (part of systemd)
# file: /etc/systemd/system/beacon-chain.service 

[Unit]
Description     = eth2 beacon chain service
Wants           = network-online.target
After           = network-online.target 

[Service]
User            = $(whoami)
WorkingDirectory= $(echo $HOME)/git/lodestar
ExecStart       = yarn run cli beacon --testnet pyrmont --eth1.providerUrl http://localhost:8545 --metrics.serverPort 8008
Restart         = on-failure

[Install]
WantedBy    = multi-user.target
EOF
```

ユニットファイルを `/etc/systemd/system` に移動し、アクセス許可を与えます。

```bash
sudo mv $HOME/beacon-chain.service /etc/systemd/system/beacon-chain.service
sudo chmod 644 /etc/systemd/system/beacon-chain.service
```

起動時に自動起動を有効にし、ビーコンノードサービスを開始するには、以下を実行します。

```text
sudo systemctl daemon-reload
sudo systemctl enable beacon-chain
sudo systemctl start beacon-chain
```

{% hint style="success" %}
よくやった。 あなたのビーコンチェーンは、システムの信頼性と堅牢性によって管理されています。 systemdを使用するためのコマンドを以下に示します。
{% endhint %}

### 🛠 systemd コマンドをいくつか使います。

#### ✅ビーコンチェーンがアクティブかどうかを確認します

```text
sudo systemctl is-active beacon-chain
```

#### 🔎 ビーコンチェーンの状態を表示

```text
sudo systemctl status beacon-chain
```

#### 🔄 ビーコンチェーンを再起動する

```text
sudo systemctl reload-or-restart beacon-chain
```

#### 🛑 ビーコンチェーンを停止します

```text
sudo systemctl stop beacon-chain
```

#### :file_cabiet: ログの表示とフィルタリングを行う

```bash
#view and follow the log
journalctl --unit=beacon-chain -f
#view log since yesterday
journctl --unit=beacon-chain ---since=today
#view log since today
journalctl --unit=beacon-chain ---since=today
#view log between a date
journctl ----unit=beacon-chain --since='202020-12-02 12:00:00:00' -since='20202020-12-02 12:00:00:00'
```

## 🧬 4.5. バリデータを開始する

systemdで自動的にバリデータを実行します。

#### 🍰 バリデータに systemd を使用する利点 <a id="benefits-of-using-systemd-for-your-stake-pool"></a>

1. メンテナンス、停電などによりコンピュータが再起動すると、バリデータを自動的に開始します。
2. クラッシュしたバリデータプロセスを自動的に再起動します。
3. バリデータの稼働時間とパフォーマンスを最大化します。

#### 🛠 セットアップ手順

**validator.service** の設定を定義する`ユニットファイル` を作成するには、以下を実行します。

```bash
cat > $HOME/validator.service << EOF 
# The eth2 validator service (part of systemd)
# file: /etc/systemd/system/validator.service 

[Unit]
Description     = eth2 validator service
Wants           = network-online.target beacon-chain.service
After           = network-online.target 

[Service]
User            = $(whoami)
WorkingDirectory= $(echo $HOME)/git/lodestar
ExecStart       = yarn run cli validator run --testnet pyrmont
Restart         = on-failure

[Install]
WantedBy    = multi-user.target
EOF
```

ユニットファイルを `/etc/systemd/system` に移動し、アクセス許可を与えます。

```bash
sudo mv $HOME/validator.service /etc/systemd/system/validator.service
sudo chmod 644 /etc/systemd/system/validator.service
```

起動時に自動起動を有効にし、バリデータを開始するには、以下を実行します。

```text
sudo systemctl daemon-reload
sudo systemctl enable validator
sudo systemctl start validator
```

{% hint style="success" %}
よくやった。 現在、バリデータはシステムの信頼性と堅牢性によって管理されています。 systemdを使用するためのコマンドを以下に示します。
{% endhint %}

### 🛠 systemd コマンドをいくつか使います。

#### ✅バリデータが有効かどうかを確認します

```text
sudo systemctl is-active validator
```

#### 🔎 バリデータの状態を表示

```text
sudo systemctl status validator
```

#### 🔄 バリデータを再起動する

```text
sudo systemctl reload-or-restart validator
```

#### 🛑 バリデータの停止

```text
sudo systemctl stop validator
```

#### :file_cabiet: ログの表示とフィルタリングを行う

```bash
#view and follow the log
journalctl --unit=validator -f
#view log since yesterday
journctl --unit=validator --since=today
#view log since today
journalctl --unit=validator --since=today
#view log between a date
journctl ---unit=validator --since='202020-12-01 00-01 00:00:00' -until='20202020-12-02 12:00:00:00:00:00'
```
{% endtab %}
{% endtabs %}

## 🕒5. 時刻同期

{% hint style="info" %}
ビーコンチェーンは認証を行い、ブロックを生成するために正確な時間に依存しています。 あなたのコンピュータの時間は0以内に実際のNTPまたはNTS時間に対して正確でなければなりません。 秒
{% endhint %}

以下のガイドで **Chrony** をセットアップしてください。

{% page-ref page="../overview-ada/guide-to-build-a-haskell-stakepool-node/how-to-setup-chrony.md" %}

{% hint style="info" %}
chronyはNetwork Time Protocolの実装であり、コンピュータの時刻をNTPと同期させるのに役立ちます。
{% endhint %}

## 🔎6. GrafanaとPrometheusでバリデータを監視する

Prometheusは、これらのターゲットのメトリックHTTPエンドポイントをスクレイピングすることによって、監視対象からメトリックを収集する監視プラットフォームです。 [公式ドキュメントはこちらから入手できます。](https://prometheus.io/docs/introduction/overview/) Grafana は収集されたデータを視覚化するために使用されるダッシュボードです。

### 🐣 6.1 インストール

prometheusとprometheusノードエクスポーターをインストールします。

```text
sudo apt-get install -y prometheus prometheus-node-exporter
```

Grafanaをインストールします。

```bash
wget -q -O - https://packages.grafana.com/gpg.key | sudo apt-key add -
echo "deb https://packages.grafana.com/oss/deb stable main" > grafana.list
sudo mv grafana.list /etc/apt/sources.list.d/grafana.list
sudo apt-get update && sudo apt-get install -y grafana
```

自動的に起動するようにサービスを有効にします。

```bash
sudo systemctl enable grafana-server.service prometheus.service prometheus-node-exporter.service
```

**prometheus.yml** 設定ファイルを作成します。 eth2クライアントのタブを選択します。

{% tabs %}
{% tab title="Lighthouse" %}
```bash
cat > $HOME/prometheus.yml << EOF
global:
  scrape_interval: 15s # デフォルトでは、15秒ごとにターゲットをスクレイプします。

  #
  # 外部システム (フェデレーション、リモートストレージ、Alertmanager) との通信時に、これらのラベルを任意の時系列またはアラートに接続します。
  external_labels:
    monitor: 'codelab-monitor'

# スクレイプするエンドポイントを含むスクレイプ構成:
# ここではプロメテウスそのものです。
scrape_configs:
   - job_name: 'node_exporter'
     static_configs:
       - targets: ['localhost:9100']
   - job_name: 'nodes'
     metrics_path: /metrics    
     static_configs:
       - targets: ['localhost:5054']
   - job_name: 'validators'
     metrics_path: /metrics
     static_configs:
       - targets: ['localhost:5064']
EOF
```
{% endtab %}

{% tab title="Nimbus" %}
```bash
cat > $HOME/prometheus.yml << EOF
global:
  scrape_interval: 15s # デフォルトでは、15秒ごとにターゲットをスクレイプします。

  #
  # 外部システム (フェデレーション、リモートストレージ、Alertmanager) との通信時に、これらのラベルを任意の時系列またはアラートに接続します。
  external_labels:
    monitor: 'codelab-monitor'

# スクレイプするエンドポイントを含むスクレイプ構成:
# ここではプロメテウスそのものです。
scripe_configs:
   - job_name: 'node_exporter'
     static_configs:
       - targets: ['localhost:9100']
   - job_name: 'nodes'
     metrics_path: /metrics    
     static_configs:
       - targets: ['localhost:8008']
EOF
```
{% endtab %}

{% tab title="Teku" %}
```bash
cat > $HOME/prometheus.yml << EOF
global:
  scrape_interval: 15s # デフォルトでは、15秒ごとにターゲットをスクレイプします。

  #
  # 外部システム (フェデレーション、リモートストレージ、Alertmanager) との通信時に、これらのラベルを任意の時系列またはアラートに接続します。
  external_labels:
    monitor: 'codelab-monitor'

# スクレイプするエンドポイントを含むスクレイプ構成:
# ここではプロメテウスそのものです。
scripe_configs:
   - job_name: 'node_exporter'
     static_configs:
       - targets: ['localhost:9100']
   - job_name: 'nodes'
     metrics_path: /metrics    
     static_configs:
       - targets: ['localhost:8008']
EOF
```
{% endtab %}

{% tab title="Prysm" %}
```bash
cat > $HOME/prometheus.yml << EOF
global:
  scrape_interval: 15s # デフォルトでは、15秒ごとにターゲットをスクレイプします。

  #
  # 外部システム (フェデレーション、リモートストレージ、Alertmanager) との通信時に、これらのラベルを任意の時系列またはアラートに接続します。
  external_labels:
    monitor: 'codelab-monitor'

# スクレイプするエンドポイントを含むスクレイプ構成:
# ここではプロメテウスそのものです。
scrape_configs:
   - job_name: 'node_exporter'
     static_configs:
       - targets: ['localhost:9100']
   - job_name: 'validator'
     static_configs:
       - targets: ['localhost:8081']
   - job_name: 'beacon node'
     static_configs:
       - targets: ['localhost:8080']
   - job_name: 'slasher'
     static_configs:
       - targets: ['localhost:8082']
EOF
```
{% endtab %}

{% tab title="Lodestar" %}
```bash
cat > $HOME/prometheus.yml << EOF   
scrape_configs:
   - job_name: 'node_exporter'
     static_configs:
       - targets: ['localhost:9100']
   - job_name: 'Lodestar'
     metrics_path: /metrics    
     static_configs:
       - targets: ['localhost:8008']
EOF
```
{% endtab %}
{% endtabs %}

**eth1 ノード** の prometheus をセットアップします。 **prometheus.yml** を編集することから始める

```bash
nano $HOME/prometheus.yml
```

eth1 ノードの適用可能なジョブスニペットを **prometheus.yml** の末尾に追加します。 ファイルを保存します。

{% hint style="warning" %}
**間隔**. `job_name` スニペットがすべて揃っていることを確認します。
{% endhint %}

{% tabs %}
{% tab title="Geth" %}
```bash
   - job_name: 'geth'
     scripe_interval: 15s
     strape_timeout: 10s
     metrics_path: /debug/metrics/prometheus
     scheme: http
     static_configs:
     - targets: ['localhost:6060']
```
{% endtab %}

{% tab title="Besu" %}
```bash
   - job_name: 'besu'
     scripe_interval: 15s
     strape_timeout: 10s
     metrics_path: /metrics
     scheme: http
     static_configs:
     - targets:
       - localhost:9545
```
{% endtab %}

{% tab title="Nethermind" %}
```bash
   - job_name: 'nethermind'
     scripe_interval: 15s
     strape_timeout: 10s
     hor_labels: true
     static_configs:
       - targets: ['localhost:9091']
```

オランダのモニタリングには [Prometheus Pushgateway](https://github.com/prometheus/pushgateway) が必要です。 以下のコマンドでインストールします。

```bash
sudo apt-get install -y prometheus-pushgateway
```

{% hint style="info" %}
Pushgateway は、ネザーマインドからポート9091のデータをリッスンします。
{% endhint %}
{% endtab %}

{% tab title="OpenEthereum" %}
```bash
作業中
```
{% endtab %}
{% endtabs %}

`/etc/prometheus/prometheus.yml` に移動します。

```bash
sudo mv $HOME/prometheus.yml /etc/prometheus/prometheus.yml
```

ファイル権限を更新します。

```bash
sudo chmod 644 /etc/prometheus/prometheus.yml
```

最後に、サービスを再起動します。

```bash
sudo systemctl restart grafana-server.service prometheus.service prometheus-node-exporter.service
```

サービスが正常に実行されていることを確認します:

```text
sudo systemctl status grafana-server.service prometheus.service prometheus-node-exporter.service
```

{% hint style="info" %}
💡 **リマインダー**: 別のマシンから監視情報を表示する場合は、ファイアウォールやポート転送時にポート3000が開いていることを確認します。
{% endhint %}

### :antera_bars: 6.2 Grafana ダッシュボードの設定

1. ローカルブラウザで [http://localhost:3000](http://localhost:3000) または http://&lt;your validator's ip address&gt;:3000 を開きます。
2. **admin** / **admin** でログイン
3. パスワードの変更
4. **設定歯車** アイコンをクリックし、 **データソースを追加**
5. **Prometheus** を選択してください
6. **の名前** を **"Prometheus** " に設定する
7. **URL** を [http://localhost:9090 に設定](http://localhost:9090)
8. **保存 & テスト** をクリックします
9. **ETH2クライアントのjsonファイルを** ダウンロードして保存します。 \[ [Lighthouse BC ](https://raw.githubusercontent.com/sigp/lighthouse-metrics/master/dashboards/Summary.json)\| [Lighthouse VC](https://raw.githubusercontent.com/sigp/lighthouse-metrics/master/dashboards/ValidatorClient.json) \| [Teku](https://grafana.com/api/dashboards/13457/revisions/2/download)[ ](https://grafana.com/api/dashboards/12522/revisions/2/download)\| [Nimbus ](https://raw.githubusercontent.com/status-im/nimbus-eth2/master/grafana/beacon_nodes_Grafana_dashboard.json)\| [Prysm ](https://raw.githubusercontent.com/GuillaumeMiralles/prysm-grafana-dashboard/master/less_10_validators.json)\| [Prysm &gt; 10 Validators](https://raw.githubusercontent.com/GuillaumeMiralles/prysm-grafana-dashboard/master/more_10_validators.json) \| Lodestar \]
10. **Download and save** your ETH1 Client's json file \[ [Geth](https://gist.githubusercontent.com/karalabe/e7ca79abdec54755ceae09c08bd090cd/raw/3a400ab90f9402f2233280afd086cb9d6aac2111/dashboard.json) \| [Besu ](https://grafana.com/api/dashboards/10273/revisions/5/download)\| [Nethermind ](https://raw.githubusercontent.com/NethermindEth/metrics-infrastructure/master/grafana/dashboards/nethermind.json)\| OpenEthereum \]
11. **Download and save** a [node-exporter dashboard](https://grafana.com/api/dashboards/11074/revisions/9/download) for general system monitoring
12. **Create +** icon &gt; **Import**
13. **アップロードJSONファイル**からETH2クライアントのダッシュボードを追加します
14. 必要に応じて、Prometheus を **Data Source** として選択します。
15. **インポート** ボタンをクリックします。
16. ETH1クライアントダッシュボードについては、ステップ12-15を繰り返します。
17. ノードエクスポーターダッシュボードについては、手順12-15を繰り返します。

{% hint style="info" %}
\*\*\*🔥 **一般的なGrafanaの問題のトラブルシューティング**:

_ダッシュボードにはeth1ノードデータは表示されません。_

* In the **eth1 unit file** under located at `/etc/systemd/system/eth1.service`,  make sure your eth1 node/geth is started with the correct parameters so that reporting metrics and pprof http server are enabled.
  * Example: `ExecStartPre = /usr/bin/geth --http --metrics --pprof`
{% endhint %}

#### ETH2クライアントごとのGrafana Dashboardの例。

{% tabs %}
{% tab title="Lighthouse" %}
![シグプによるビーコンチェーンダッシュボード](../../.gitbook/assets/lhm.png)

![sigp によるバリデータークライアントダッシュボード](../../.gitbook/assets/lighthouse-validator.png)

クレジット: [https://github.com/sigp/lighthouse-metrics/](https://github.com/sigp/lighthouse-metrics/)
{% endtab %}

{% tab title="Nimbus" %}
![Dashboard by status-im](../../.gitbook/assets/nim_dashboard.png)

クレジット: [https://github.com/status-im/nimbus-eth2/](https://github.com/status-im/nimbus-eth2/)
{% endtab %}

{% tab title="Teku" %}
![Tekuby PegaSys Engineering](../../.gitbook/assets/teku.dash.png)

クレジット: [https://grafana.com/grafana/dashboards/13457](https://grafana.com/grafana/dashboards/13457)
{% endtab %}

{% tab title="Prysm" %}
![Prysm ダッシュボード by GuillaumeMiralles](../../.gitbook/assets/prysm_dash.png)

Credits: [https://github.com/GuillaumeMiralles/prysm-grafana-dashboard](https://github.com/GuillaumeMiralles/prysm-grafana-dashboard)
{% endtab %}

{% tab title="Lodestar" %}
作業中です。
{% endtab %}
{% endtabs %}

#### ETH1ノードごとのGrafana Dashboardの例。

{% tabs %}
{% tab title="Geth" %}
![ダッシュボード（カララベ）](../../.gitbook/assets/geth-dash.png)

クレジット: [https://gist.github.com/karalabe/e7ca79abdec54755ceae09c08bd090cd](https://gist.github.com/karalabe/e7ca79abdec54755ceae09c08bd090cd)
{% endtab %}

{% tab title="Besu" %}
![](../../.gitbook/assets/besu-dash.png)

クレジット: [https://grafana.com/dashboards/10273](https://grafana.com/dashboards/10273)
{% endtab %}

{% tab title="Nethermind" %}
![](../../.gitbook/assets/nethermind-dash.png)

Credits: [https://github.com/NethermindEth/metrics-インフラストラクチャ](https://github.com/NethermindEth/metrics-infrastructure)
{% endtab %}

{% tab title="OpenEthereum" %}
作業中
{% endtab %}
{% endtabs %}

#### Node-Exporter ダッシュボードの例

{% tabs %}
{% tab title="Node-Exporter Dashboard by starsliao" %}
**一般的なシステム監視**

CPU、メモリ、ディスクIO、ネットワーク、温度およびその他の監視指標が含まれます。

![](../../.gitbook/assets/node-exporter.png)

![](../../.gitbook/assets/node-exporter2.png)

クレジット: [starsliao](https://grafana.com/grafana/dashboards/11074)
{% endtab %}
{% endtabs %}

### ⚠ 6.3 アラート通知の設定

{% hint style="info" %}
バリデータがオフラインになった場合に通知を受け取るためのアラートを設定します。
{% endhint %}

バリデータに関する問題の通知を受け取ります。 電子メール、電報、discord、またはスラックのいずれかを選択します。

{% tabs %}
{% tab title="Email Notifications" %}
1. [https://pyrmont.beaconcha.in/](https://pyrmont.beaconcha.in/) をご覧ください
2. アカウントにサインアップします。
3. **メールアドレス** を確認してください
4. **バリデータの公開アドレス**を検索する
5. **ブックマーク** をクリックして、ウォッチリストにバリデーターを追加します。
{% endtab %}

{% tab title="Telegram Notifications" %}
1. Grafanaのメニューで、ベルアイコンの下にある **通知チャンネル** を選択します。
2. **Add channel** をクリックします。
3. 通知チャンネルに **の名前** を付けます。
4. タイプリストから **テレグラム** を選択します。
5. **Telegram API の設定**を完了するには、 **Telegram チャンネル** と **ボット** が必要です。 `@Botfather`でボットをセットアップする方法については、Telegramのドキュメントの [このセクション](https://core.telegram.org/bots#6-botfather) を参照してください。 BotのAPIトークンを作成する必要があります。
6. 新しい電報グループを作成します。
7. ボットを新しいグループに招待します。
8. グループに少なくとも1つのメッセージを入力して初期化します。
9. [をご覧ください`https://api.telegram.org/botXXX:YYY/getUpdates`](https://api.telegram.org/botXXX:YYY/getUpdates) ここで `XXX:YYY` はあなたのBOTAPIトークンです。
10. JSON 応答で、 **チャット ID** を見つけてコピーします。 **チャット** と **タイトル** の間で検索します。 _チャットIDの例_: `-1123123123`

    ```text
    "chat":{"id":-123123,"title":
    ```

11. **Grafana** の対応するフィールドに **チャット ID** を貼り付けます。
12. **アラートの通知チャンネルを** 保存してテストします。
13. ダッシュボードからカスタムアラートを作成できるようになりました。 [アラートの作成方法については、こちらをご覧ください。](https://grafana.com/docs/grafana/latest/alerting/create-alerts/)
{% endtab %}

{% tab title="Discord Notifications" %}
1. Grafanaのメニューで、ベルアイコンの下にある **通知チャンネル** を選択します。
2. **Add channel** をクリックします。
3. 通知チャンネルに **の名前** を追加します。
4. タイプリストから **Discord** を選択します。
5. 設定を完了するには、Discordサーバーの\(およびテキストチャンネルが利用可能\)とWebhookのURLが必要です。 Discordの Webhook の設定方法については、ドキュメントの [このセクション](https://support.discord.com/hc/en-us/articles/228383668-Intro-to-Webhooks) を参照してください。
6. Discordの通知設定パネルにWebhook **URL** を入力します。
7. **Send Test**をクリックすると、Discordチャンネルに確認メッセージが送信されます。
{% endtab %}

{% tab title="Slack Notifications" %}
1. Grafanaのメニューで、ベルアイコンの下にある **通知チャンネル** を選択します。
2. **Add channel** をクリックします。
3. 通知チャンネルに **の名前** を追加します。
4. **リストから** を選択します。
5. Slack の Incoming Webhooks のセットアップ方法については、ドキュメントの [このセクション](https://api.slack.com/messaging/webhooks) を参照してください。
6. Slack Incoming Webhook URL を **URL** フィールドに入力します。
7. **Send Test**をクリックすると、Slackチャンネルに確認メッセージが送信されます。
{% endtab %}
{% endtabs %}

### 🌊 6.4 アップタイムによるモニタリング Google Cloud によるチェック

{% hint style="info" %}
誰が見張りをしているのか。 Uptime Checkのような外部サードパーティツールを使用してください。 電源障害やハードウェア障害などの災害の際に検証器が機能していることを もっと確信させることができる これらのシナリオでは、PrometheusとGrafanaによる前述の監視も機能しなくなる可能性があります。

[Mohamed Mansourへの貢献は、このガイド](https://www.youtube.com/watch?v=txgOVDTemPQ) を鼓舞してくれた。
{% endhint %}

GoogleのUptime Checkという無償監視サービスのセットアップ方法は次のとおりです。

{% hint style="info" %}
ビデオのデモは、 [MohamedMansourのeth2教育ビデオ](https://www.youtube.com/watch?v=txgOVDTemPQ) をご覧ください。 彼の [GITCOIN助成金](https://gitcoin.co/grants/1709/video-educational-grant)を支援してください。 🙏
{% endhint %}

1. [cloud.google.com](https://cloud.google.com/) を訪問
2. 検索フィールドで **モニタリング** を検索します。
3. **モニタリングを開始するプロジェクトを選択** をクリックします。
4. **新規プロジェクト** をクリックします。
5. **** プロジェクトに名前を付け、 **作成をクリックします。**
6. format@@0メニューから、新しいプロジェクトを選択します。
7. 右側の列にモニタリングカードがあります。 **** をクリックします。
8. 左のメニューで **アップタイムチェック** をクリックし、 **UPTIMEチェックを作成します。**
9. タイトルを入力してください。例: _**Geth ノード**_
10. プロトコルを _**TCP**_ として選択してください
11. パブリックIPアドレスとポート番号を入力します。 すなわち、ip=**7.55.6.3** and port=**30303**
12. ご希望の周波数を選択してください。例: **5分**
13. チェックする最も近い地域を選択してください。 「次へ」をクリックします。
14. 通知チャンネルを作成する。 **通知チャンネルの管理をクリックします。**
15. ご希望の設定を選択してください。 Slack、Webhook、Eメール、SMSのいずれかまたはすべてから選択
16. 「稼働時間を確認する」ウィンドウに戻ります。
17. format@@0フィールドで、format@@1ボタンをクリックして新しい通知チャンネルをロードします。
18. 希望する通知を選択します。
19. **TEST** をクリックして、通知が正しく設定されていることを確認します。
20. **CREATE** をクリックして終了します。

{% hint style="success" %}
ビーコンチェーンの同期、検証、実行が完了したら、アクティベーションを待つだけです。 このプロセスには24時間以上かかることがあります。 あなたが割り当てられると、あなたのバリデーターはステーク報酬を獲得しながらブロックの作成と投票を開始します。

[https://pyrmont.beaconcha.in/](https://pyrmont.beaconcha.in/) を使用してアラートを作成し、バリデータのパフォーマンスを追跡します。
{% endhint %}

{% hint style="info" %}
必ず [チェックリスト\| 健全な機能ETH2バリデータを確認する方法を確認してください。](guide-or-how-to-setup-a-validator-on-eth2-mainnet/checklist-or-how-to-confirm-a-healthy-functional-eth2-validator.md)
{% endhint %}

{% hint style="success" %}
🎉testnet バリデーターの設定おめでとうございます！ あなたは行って、メインネットeth2.0を試してみて良いです。

私たちのガイドが役に立ちましたか？ ヒント付きのシグナルを送信してください。アップデートを続けます。

[coint.eeを使用して、寄付 ](https://cointr.ee/coincashew)アドレスを見つけてください。 🙏

どんなフィードバックとすべてのプルリクエストは非常に高く評価されます。 🌛

Discord @ で仲間のステーカーとチャットしましょう [https://discord.gg/w8Bx8W2HPW](https://discord.gg/w8Bx8W2HPW)😃
{% endhint %}

## 🧙♂7. Update a ETH2 client

新しいリリースがカットされた場合は、最新の安定リリースに更新したいと思います。 以下に、eth2ビーコンチェーンとバリデータを更新する方法を示します。

{% hint style="info" %}
更新前に **git ログを`git ログ`** または **リリース ノート** で常に確認してください。 注意が必要な変更があるかもしれません。
{% endhint %}

ETH2クライアントを選択します。

{% tabs %}
{% tab title="Lighthouse" %}
リリースノートを確認し、破損している変更/機能を確認してください。

[https://github.com/sigp/lightouse/releases](https://github.com/sigp/lighthouse/releases)

最新のソースを取得してビルドします。

```bash
cd $HOME/git/灯台
git fetch --all && git checkout stable && git pull
make
```

新しいバージョン番号を確認してビルドが完了したことを確認します。

```bash
lighouse --version
```

通常の操作手順に従ってビーコンチェーンとバリデータを再起動します。

```text
sudo systemctl reload-or-restart beacon-chain
sudo systemctl reload-or-restart validator
```
{% endtab %}

{% tab title="Nimbus" %}
リリースノートを確認し、破損している変更/機能を確認してください。

[https://github.com/status-im/nimbus-eth2/releases](https://github.com/status-im/nimbus-eth2/releases)

最新のソースを取得してビルドします。

```bash
cd $HOME/git/nimbus-eth2
git pull && make update
make NIMFLAGS="-d:insecure" nimbus_beacon_node
```

新しいバージョン番号を確認してビルドが完了したことを確認します。

```bash
cd $HOME/git/nimbus-eth2/build
./nimbus_beacon_node --version
```

通常の操作手順に従って、新しいバイナリをコピーし、ビーコンチェーンとバリデータを再起動します。

```bash
sudo systemctl stop beacon-chain
sudo rm /usr/bin/nimbus_beacon_node
sudo cp $HOME/git/nimbus-eth2/build/nimbus_beacon_node /usr/bin
sudo systemctl reload-or-rerestart beacon-chain
```
{% endtab %}

{% tab title="Teku" %}
リリースノートを確認し、破損している変更/機能を確認してください。

[https://github.com/ConsenSys/teku/releases](https://github.com/ConsenSys/teku/releases)

最新のソースを取得してビルドします。

```bash
cd $HOME/git/teku
git pull
./gradlew distTar installDist
```

新しいバージョン番号を確認してビルドが完了したことを確認します。

```bash
cd $HOME/git/teku/build/install/teku/bin
./teku -version
```

通常の操作手順に従ってビーコンチェーンとバリデータを再起動します。

```bash
sudo systemctl stop beacon-chain
sudo rm -rf /usr/bin/teku
sudo cp -r $HOME/git/teku/build/install/teku /usr/bin/teku
sudo systemctl reload-or-restart beacon-chain
```
{% endtab %}

{% tab title="Prysm" %}
リリースノートを確認し、破損している変更/機能を確認してください。 [https://github.com/prysmaticlabs/prysm/releases](https://github.com/prysmaticlabs/prysm/releases)

```bash
#プロセス
sudo systemctl reload-or-restart beacon-chain validator
```
{% endtab %}

{% tab title="Lodestar" %}
リリースノートを確認し、破損している変更/機能を確認してください。

[https://github.com/ChainSafe/lodestar/releases](https://github.com/ChainSafe/lodestar/releases)

最新のソースを取得してビルドします。

```bash
cd $HOME/git/lodestar
git pull
yarn install
yarn run build
```

新しいバージョン番号を確認してビルドが完了したことを確認します。

```bash
yarn run cli --version
```

通常の操作手順に従ってビーコンチェーンとバリデータを再起動します。

```text
sudo systemctl reload-or-restart beacon-chain
sudo systemctl reload-or-restart validator
```
{% endtab %}
{% endtabs %}

ログを確認して、サービスが正常に動作していることを確認し、エラーがないことを確認してください。

{% tabs %}
{% tab title="Lighthouse \| Prysm \| Lodestar" %}
```bash
sudo systemctl status beacon-chain validator
```
{% endtab %}

{% tab title="Nimbus \| Teku" %}
```
sudo systemctl status beacon-chain
```
{% endtab %}
{% endtabs %}

## 🔥8. 追加の役に立つヒント

### 🛑 8.1 バリデータを任意に終了する

{% hint style="info" %}
このコマンドを使用して、バリデーターで検証を停止する意図を知らせます。 これは、もはやあなたのバリデータとステークしたくなくなり、ノードをオフにしたいことを意味します。

* 自発的な終了は、最低2048エポック\(または〜9日間\)かかります。 終了するキューがあり、バリデータが最終的に終了するまでの遅延があります。
* フェーズ0でバリデータを終了すると、元に戻すことができなくなり、再度バリデーションを再開することはできません。
* あなたの資金は、フェーズ1.5以降まで引き出しできません。
* あなたのバリデータが終了キューを離れ、本当に終了したら、ビーコンノードとバリデータをオフにしても安全です。
{% endhint %}

{% tabs %}
{% tab title="Lighthouse" %}
```bash
lightthouse account validator exit \
--keystore $HOME/.lighothouse/pyrmont/validators \
--beacon-node http://localhost:5052 \
--network pyrmont
```
{% endtab %}

{% tab title="Teku" %}
```bash
tekuwelfy-exit \
--epoch=<epoch number to exit> \
--beacon-node-api-endpoint=http://127.0.0.1:5051 \
--validator-keys=<path to keystore.json>:<path to password.txt file>
```
{% endtab %}

{% tab title="Nimbus" %}
```bash
build/nimbus_beacon_node deposits exit --validator=<VALIDATOR_PUBLIC_KEY> --data-dir=/var/lib/nimbus
```
{% endtab %}

{% tab title="Prysm" %}
```bash
$HOME/prysm/prysm.sh バリデーターアカウントを自発的に終了
```
{% endtab %}

{% tab title="Lodestar" %}
```bash
#To be determined
```
{% endtab %}
{% endtabs %}

### 🗝 8.2 ニーモニックフレーズを確認

eth2deposit-cli ツールを使用して、 `validator_keys` を復元して同じeth2キーペアを再生成できるようにします。

```bash
cd $HOME/eth2deposit-cli 
./deposit.sh existing-mnemonic --chain pyrmont
```

{% hint style="info" %}
両方の **pubkey** が **キーストアファイル** で同一の **の場合、** これは、ニーモニックフレーズが非常に正しいことを意味します。 塩漬けのために他のフィールドは異なるでしょう。
{% endhint %}

### 🤖8.3 バリデーターを追加する



既存の `validator_key` ディレクトリをバックアップし、最後に日付を追加します。

```bash
# Adjust your eth2deposit-cli directory accordingly
cd $HOME/eth2deposit-cli
# Renames and append the date to the existing validator_key directory
mv validator_key validator_key_$(date +"%Y%d%m-%H%M%S")
# Optional: you can also delete this folder since it can be regenerated.
```

{% hint style="info" %}
eth2deposit-cli ツールを使用して、新しい入金データファイルと `validator_keys` を作成することで、バリデータをさらに追加できます。
{% endhint %}

2. 例えば、我々がもともと **3 バリデータ** を作成した場合、 **さらに5つのバリデータを追加したい**、 次のコマンドを使うことができます [**eth2depositツール**](https://github.com/ethereum/eth2.0-deposit-cli) の取得方法に応じてタブを選択します。

{% hint style="warning" %}
**セキュリティ推奨通知**: セキュリティのベストプラクティスのために、 24語のニーモニックシードを入力するキー管理やその他のアクティビティは、USBドライブから起動されたエアーラップされたオフラインのコールドマシン上で完了する必要があります。
{% endhint %}

{% hint style="danger" %}
同じ **キーストアのパスワード**を使用するように通知します。
{% endhint %}

{% tabs %}
{% tab title="Build from source code" %}
```bash
# 既存のニーモニックから 5 個以上のバリデータを生成する 3 が既に作成されている場合
./deposit.sh existing-mnemonic --validator_start_index 3 --num_validators 5 --chain pyrmont
```
{% endtab %}

{% tab title="Pre-built eth2deposit-cli binaries" %}
```bash
# 既存のニーモニックから生成する 5 つ以上のバリデータが 3 以前に作成されたときに
./deposition-mnemonic --validator_start_index 3 --num_validators 5 --chain pyrmont
```
{% endtab %}

{% tab title="Advanced - Most Secure" %}
{% hint style="warning" %}
🔥**Pro Security Tip**: **eth2deposit-cli ツール** を実行し、 **mnemonic seed** を **usb から起動したエアーギャップ付きオフラインマシン上でバリデータキーに生成します。**.
{% endhint %}

起動可能な usb を作る際に、この [ethstaker.cc](https://ethstaker.cc/) をローダウン専用にフォローしてください。

### パート1 - Ubuntu 20.04 USBブート可能なドライブを作成

{% embed url="https://www.youtube.com/watch?v=DTR3PzRtYU" %}

### パート2 - USBドライブからUbuntu 20.04をインストールします

{% embed url="https://www.youtube.com/watch?v=C97\_6MrufCE" %}

USBキーを介して、USBから起動されたエアラップされたオフラインマシンにオンラインマシンから、事前に構築されたeth2deposit-cliバイナリをコピーすることができます。 イーサネットケーブルおよび/またはWi-Fiを取り外してください。

前のタブで existing-mnemonic コマンドを実行します。
{% endtab %}
{% endtabs %}

3. `deposit_data-#######をアップロードする手順を完了します。 息子 <code>` [公式の Eth2 ローンチパッドサイト](https://launchpad.ethereum.org/) にアクセスし、対応する 32 ETHの入金取引を行います。

4. Finish by stopping your validator, importing the new validator key\(s\), restarting your validator and verifying the logs confirming everything still work without error. [リフレッシュが必要な場合は、メインガイドのステップ2を確認してください。](guide-or-how-to-setup-a-validator-on-eth2-mainnet/#2-signup-to-be-a-validator-at-the-launchpad)

5. 最後に、 **既存の** バリデーターの認証がパブリックブロックエクスプローラーのように動作していることを確認してください。

[https://pyrmont.beaconcha.in/](https://pyrmont.beaconcha.in/)

ステータスを表示するには、バリデータのパブキーを入力してください。

{% hint style="info" %}
追加のバリデータは、アクティベーションキューにあります。
{% endhint %}

### 💸 8.4 スラッシュ保護で eth2 クライアントを切り替え/変更

{% hint style="info" %}
このプロセスの重要なポイントは、同時に2つのeth2クライアントを実行することを避けることです。 あなたはエーテルの損失を引き起こすスラッシングペナルティによって罰せられることを避けたい。
{% endhint %}

#### 🛑 8.4.1 古いビーコンチェーンと古いバリデータを停止します。

スラッシング データベースをエクスポートするには、バリデータを停止する必要があります。

{% tabs %}
{% tab title="Lighthouse \| Prysm \| Lodestar" %}
```bash
sudo systemctl stop beacon-chain validator
```
{% endtab %}

{% tab title="Nimbus \| Teku" %}
```
sudo systemctl stop beacon-chain
```
{% endtab %}
{% endtabs %}

#### 💽 8.4.2 スラッシュデータベースのエクスポート \(オプション\)

{% hint style="info" %}
[EIP-3076](https://eips.ethereum.org/EIPS/eip-3076) は、eth2 クライアント間の安全移行バリデータ鍵の標準を実装している。 これは、スラッシングデータベースのエクスポートされた内容です。
{% endhint %}

エクスポート .json ファイルの場所と名前を更新します。

{% tabs %}
{% tab title="Lighthouse" %}
```bash
灯台アカウントのバリデータのスラッシング保護エクスポート <lighthouse_interchange.json>
```
{% endtab %}

{% tab title="Nimbus" %}
実装するには
{% endtab %}

{% tab title="Teku" %}
```bash
teku slashing-protection export --to=<FILE>
```
{% endtab %}

{% tab title="Prysm" %}
実装するには
{% endtab %}

{% tab title="Lodestar" %}
実装するには
{% endtab %}
{% endtabs %}

#### 🚧 8.4.3 新しいバリデーター/ビーコンチェーンをセットアップしてインストール

新しいバリデータ **をセットアップ/インストールする必要がありますが、systemd プロセスの実行を開始しないでください**。 新しいバリデーターの  [セクション4に従ってください。 ETH2ビーコンチェーンとバリデーターを設定します。](guide-or-how-to-setup-a-validator-on-eth2-testnet.md#4-configure-a-eth2-beacon-chain-node-and-validator) クライアントのビルド/インストール、ポート転送/ファイアウォール、および新しいsystemdユニットファイルが必要です。

{% hint style="warning" %}
\*\*\*\*✨ **Pro Tip**: During the process of re-importing validator keys, **wait at least 13 minutes** or two epochs to prevent slashing penalties. 同じバリデータキーを持つ2つのeth2クライアントを同時に実行することは避ける必要があります。
{% endhint %}

{% hint style="danger" %}
🛑 **Critical Step**: Do not start any **systemd processes** until either you have **imported the slashing database** or you have **waited at least 13 minutes or two epochs**.
{% endhint %}

#### 📂 8.4.4 スラッシング データベースをインポート \(オプション\'

新しいeth2クライアントを使用して、次のコマンドを実行し、2ステップ前からスラッシングデータベースをインポートするための関連するパスを更新します。

{% tabs %}
{% tab title="Lighthouse" %}
```bash
灯台アカウントのバリデータのスラッシング保護インポート <my_interchange.json>
```
{% endtab %}

{% tab title="Nimbus" %}
実装するには
{% endtab %}

{% tab title="Teku" %}
```bash
tekuスラッシング保護 import --from=<FILE>
```
{% endtab %}

{% tab title="Prysm" %}
実装するには
{% endtab %}

{% tab title="Lodestar" %}
実装するには
{% endtab %}
{% endtabs %}

#### 🌠 8.4.5 新しいバリデータと新しいビーコンチェーンを開始

{% tabs %}
{% tab title="Lighthouse \| Prysm \| Lodestar" %}
```bash
sudo systemctl start beacon-chain validator
```
{% endtab %}

{% tab title="Nimbus \| Teku" %}
```
sudo systemctl start beacon-chain
```
{% endtab %}
{% endtabs %}

#### 🔥 8.4.6 機能を確認する

ログを確認して、サービスが正常に動作していることを確認し、エラーがないことを確認してください。

{% tabs %}
{% tab title="Lighthouse \| Prysm \| Lodestar" %}
```bash
sudo systemctl status beacon-chain validator
```
{% endtab %}

{% tab title="Nimbus \| Teku" %}
```
sudo systemctl status beacon-chain
```
{% endtab %}
{% endtabs %}

最後に、検証者の認証がパブリックブロックエクスプローラで動作していることを確認してください。

[https://pyrmont.beaconcha.in/](https://pyrmont.beaconcha.in/)

ステータスを表示するには、バリデータのパブキーを入力してください。

#### :fire_extingisher: 8.4.7 Prometheus と Grafana によるアップデート監視

[セクション 6](guide-or-how-to-setup-a-validator-on-eth2-testnet.md#6-monitoring-your-validator-with-grafana-and-prometheus) を確認し、 `prometheus.yml` を変更します。 prometheusが新しいeth2クライアントのメトリックポートに接続されていることを確認してください。 新しいeth2クライアントのダッシュボードをインポートすることもできます。

### 🖥 8.5 利用可能なすべてのLVMディスク領域を使用する

Ubuntu Serverのインストール中に、ハードドライブの空き容量が不足している場合に一般的な問題が発生します。

```bash
# View your disk drives
sudo -s lvm

# Change the logical volume filesystem path if required
lvextend -l +100%FREE /dev/ubuntu-vg/ubuntu-lv

#exit lvextend
exit

# Resize file system to use the new available space in the logical volume
resize2fs /dev/ubuntu-vg/ubuntu-lv

## Verify new available space
df -h

# Example output of a 2TB drive where 25% is used
# Filesystem                         Size   Used Avail Use% Mounted on
# /dev/ubuntu-vg/ubuntu-lv           2000G  500G  1500G  25% /
```

**ソースリファレンス**:

{% embed url="https://askubuntu.com/questions/1106795/ubuntu-server-18-04-lvm-out-space-with-imper-default-partitioning" %}

### 🚦 8.6 ネットワーク帯域幅の使用量を削減

{% hint style="info" %}
独自のETH1ノードをホストすると、1日に数百ギガバイトのデータを消費することができます。 データプランは制限されたりコストがかかる可能性があるため、データ使用量を減らしたり、ネットワークへの良好な接続を維持したりする必要があるかもしれません。
{% endhint %}

eth1.service unit ファイルを編集します。

```bash
sudo nano /etc/systemd/system/eth1.service
```

`ExecStart` 行のピア数を制限するには、次のフラグを追加します。

{% tabs %}
{% tab title="Geth" %}
```bash
--maxpeers 10
# Example
# ExecStart       = /usr/bin/geth --maxpeers 10 --http --goerli --ws
```
{% endtab %}

{% tab title="OpenEthereum \(Parity\)" %}
```bash
--max-peers 10
# 例
# ExecStart = $(echo $HOME)/openethereum/openeterum --max-peers 10 --chain goerli
```
{% endtab %}

{% tab title="Besu" %}
```bash
--max-peers 10
# 例
# ExecStart = <home directory>/besu/bin/besu --max-peers 10 --rpc-http-enabled --network=goerli
```
{% endtab %}

{% tab title="Nethermind" %}
```bash
--Network.ActivePeersMaxCount 10
# Example
# ExecStart = <home directory>/nethermind/Nethermind.Runner --Network.ActivePeersMaxCount 10 --config goerli -JsonRpc.Enabled true
```
{% endtab %}
{% endtabs %}

最後に、新しいユニットファイルをリロードし、eth1 ノードを再起動します。

```bash
sudo systemctl daemon-reload
sudo systemctl restart eth1
```

### 📂 8.7 重要なディレクトリ場所

{% hint style="info" %}
バリデータキーまたはデータベースディレクトリを見つける必要がある場合。
{% endhint %}

{% tabs %}
{% tab title="Lighthouse" %}
```bash
# Validator Keys
~/.lighthouse/pyrmont/validators

# Beacon Chain Data
~/.lighthouse/pyrmont/beacon

# List of all validators and passwords
~/.lighthouse/pyrmont/validators/validator_definitions.yml

#Slash protection db
~/.lighthouse/pyrmont/validators/slashing_protection.sqlite
```
{% endtab %}

{% tab title="Nimbus" %}
```bash
# バリデーターキー
/var/lib/nimbus/validators

# ビーコンチェーンデータ
/var/lib/nimbus/db

#Slash protection db
/var/lib/nimbus/validators/slashing_protector.sqlite3

#Logs
/var/lib/nimbus/beacon.log
```
{% endtab %}

{% tab title="Teku" %}
```bash
# バリデーターキー
/var/lib/teku

# Beacon Chain Data
~/tekudata/beacon

#Slash protection db
~/tekudata/validator/slashprotection
```
{% endtab %}

{% tab title="Prysm" %}
```bash
# Validator Keys
~/.eth2validators/prysm-wallet-v2/direct

# Beacon Chain Data
~/.eth2/beaconchaindata
```
{% endtab %}

{% tab title="Lodestar" %}
TBD
{% endtab %}
{% endtabs %}

### 🌏 8.8 ETH1ノードを別のマシンでホスティングする

{% hint style="info" %}
ビーコンチェーンとバリデータがどこにあるのかと異なるマシン上で独自のETH1ノードをホストすることで、モジュール性と柔軟性を高めることができます。
{% endhint %}

eth1 ノード マシンで、eth1.service unit ファイルを編集します。

```bash
sudo nano /etc/systemd/system/eth1.service
```

`ExecStart` 行で、リモートからの http や websocket API 要求を許可するために次のフラグを追加します。

{% hint style="info" %}
websocketを使用していない場合、wsパラメータを含める必要はありません。 Nimbus のみウェブソケットが必要です。
{% endhint %}

{% tabs %}
{% tab title="Geth" %}
```bash
--http.addr 0.0.0.0 --ws.addr 0.0.0.0
# Example
# ExecStart       = /usr/bin/geth --http.addr 0.0.0.0 --ws.addr 0.0.0.0 --http --ws
```
{% endtab %}

{% tab title="OpenEthereum \(Parity\)" %}
```bash
--jsonrpc-interface=all --ws-interface=all
# Example
# ExecStart = <home directory>/openetereum/openethereum --jsonrpc-interface=all --ws-interface=all
```
{% endtab %}

{% tab title="Besu" %}
```bash
--rpc-http-host=0.0.0.0 --rpc-ws-enabled --rpc-ws-host=0.0.0.0
# 例
# ExecStart = <home directory>/besu/bin/besu --rpc-http-host=0.0.0.0 --rpc-ws-enabled ---rpc-ws-host=0.0.0.0 --rpc-http-enabled
```
{% endtab %}

{% tab title="Nethermind" %}
```bash
--JsonRpc.Host 0.0.0.0 --WebSocketsEnabled
# 例
# ExecStart = <home directory>/nethermind/Nethermind.Runner --JsonRpc.Host 0.0.0.0.0 --WebSocketsEnabled -JsonRpc.Enabled true
```
{% endtab %}
{% endtabs %}

新しいユニットファイルを再読み込みし、eth1ノードを再起動します。

```bash
sudo systemctl daemon-reload
sudo systemctl restart eth1
```

ビーコンチェーンをホストする別のマシンで、beacon-chain unit ファイルを eth1 ノードの IP アドレスで更新します。

{% tabs %}
{% tab title="Lighthouse" %}
```bash
# beacon-chain unit file
nano /etc/systemd/system/beacon-chain.service
# add the --eth1-endpoints parameter
# example
# --eth1-endpoints=http://192.168.10.22
```
{% endtab %}

{% tab title="Nimbus" %}
```bash
# beacon chain unit file
nano /etc/systemd/system/beacon-chain.service
# modify the --web-url parameter
# example
# --web3-url=ws://192.168.10.22
```
{% endtab %}

{% tab title="Teku" %}
```bash
# edit teku.yaml
nano /etc/teku/teku.yaml
# change the eth1-endpoint
# example
# eth1-endpoint: "http://192.168.10.20:8545"
```
{% endtab %}

{% tab title="Prysm" %}
```bash
# editbeacon-chain unit file
nano /etc/systemd/system/beacon-chain.service
# add the --http-web3provider parameter
# example
# --http-web3provider=http://192.168.10.20:8545
```
{% endtab %}

{% tab title="Lodestar" %}
```
tbdだ
```
{% endtab %}
{% endtabs %}

更新されたユニットファイルを再読み込みし、ビーコンチェーンを再起動します。

```bash
sudo systemctl daemon-reload
sudo systemctl restart beacon-chain
```

### 🎊 8.9 POAP グラフィティフラグを追加または変更

`落書き`をセットアップし、バリデータが正常に提案するブロックに含まれるカスタムメッセージを設定し、早期ビーコンチェーンのバリデータPOAPトークンを獲得します。 [ここでイーサリアム1.0アドレスを指定してPOAP文字列を生成します。](https://beaconcha.in/poap)

`MY_GRAFFITI` 変数を設定するには、次のコマンドを実行します。 `<my POAP string or message>`  を単一引用符で置き換えます。

```bash
MY_GRAFFITI== '<my POAP string or message>'
# 例
# MY_GRAFFITI='poapAAACGatUA1bLuDnL4FMD13BfoD'
# MY_GRAFFITI='eth2 rulez!'
```

{% hint style="info" %}
[POAP - 出席証明トークンの詳細について。 ](https://www.poap.xyz/)
{% endhint %}

{% tabs %}
{% tab title="Lighthouse" %}
**validator.service** の設定を定義するために`ユニットファイル` を再作成するには、以下を実行します。 コピーして貼り付けるだけです。

```bash
cat > $HOME/validator.service << EOF 
# The eth2 validator service (part of systemd)
# file: /etc/systemd/system/validator.service 

[Unit]
Description     = eth2 validator service
Wants           = network-online.target beacon-chain.service
After           = network-online.target 

[Service]
User            = $(whoami)
ExecStart       = $(which lighthouse) vc --network pyrmont --graffiti "${MY_GRAFFITI}" 
Restart         = on-failure

[Install]
WantedBy    = multi-user.target
EOF
```

ユニットファイルを `/etc/systemd/system に移動します`

```bash
sudo mv $HOME/validator.service /etc/systemd/system/validator.service
```

ファイル権限を更新します。

```bash
sudo chmod 644 /etc/systemd/system/validator.service
```
{% endtab %}

{% tab title="Nimbus" %}
**beacon-chain.service** の設定を定義するために、次のように`ユニットファイル` を再作成します。 コピーして貼り付けるだけです。

```bash
cat > $HOME/beacon-chain.service << EOF 
# The eth2 beacon chain service (part of systemd)
# file: /etc/systemd/system/beacon-chain.service 

[Unit]
Description     = eth2 beacon chain service
Wants           = network-online.target
After           = network-online.target 

[Service]
Type            = simple
User            = $(whoami)
WorkingDirectory= /var/lib/nimbus
ExecStart       = /usr/bin/nimbus_beacon_node --network=pyrmont --graffiti="${MY_GRAFFITI}" --data-dir=/var/lib/nimbus --web3-url=ws://127.0.0.1:8546 --metrics --metrics-port=8008 --rpc --rpc-port=9091 --validators-dir=/var/lib/nimbus/validators --secrets-dir=/var/lib/nimbus/secrets --log-file=/var/lib/nimbus/beacon.log
Restart         = on-failure

[Install]
WantedBy    = multi-user.target
EOF
```

{% hint style="warning" %}
Nimbus は ETH1 ノードの websocket 接続 \("ws://" と "wss://"\' のみをサポートしています。 Geth, OpenEthereum, Infura ETH1ノードの互換性が検証されています。
{% endhint %}

ユニットファイルを `/etc/systemd/system に移動します`

```bash
sudo mv $HOME/beacon-chain.service /etc/systemd/system/beacon-chain.service
```

ファイル権限を更新します。

```bash
sudo chmod 644 /etc/systemd/system/beacon-chain.service
```
{% endtab %}

{% tab title="Teku" %}
Teku設定ファイルを再生成します。 コピーして貼り付けるだけです。

```bash
cat > $HOME/teku.yaml << EOF
# network
network: "pyrmont"

# p2p
p2p-enabled: true
p2p-port: 9000
# validators
validator-keys: "/var/lib/teku/validator_keys:/var/lib/teku/validator_keys"
validators-graffiti: "${MY_GRAFFITI}"

# Eth 1
eth1-endpoint: "http://localhost:8545"

# metrics
metrics-enabled: true
metrics-categories: ["BEACON","LIBP2P","NETWORK"]
metrics-port: 8008

# database
data-path: "$(echo $HOME)/tekudata"
data-storage-mode: "archive"

# rest api
rest-api-port: 5051
rest-api-docs-enabled: true
rest-api-enabled: true

# logging
log-include-validator-duties-enabled: true
log-destination: CONSOLE
EOF
```

設定ファイルを `/etc/teku`に移動する

```bash
sudo mv $HOME/teku.yaml /etc/teku/teku.yaml
```
{% endtab %}

{% tab title="Prysm" %}
**validator.service** の設定を定義するために、`ユニットファイル` を再作成します。 コピーして貼り付けるだけです。

```bash
cat > $HOME/validator.service << EOF 
# The eth2 validator service (part of systemd)
# file: /etc/systemd/system/validator.service 

[Unit]
Description     = eth2 validator service
Wants           = network-online.target beacon-chain.service
After           = network-online.target 

[Service]
User            = $(whoami)
ExecStart       = $(echo $HOME)/prysm/prysm.sh validator --pyrmont --graffiti "${MY_GRAFFITI}" --accept-terms-of-use --wallet-password-file $(echo $HOME)/.eth2validators/validators-password.txt
Restart         = on-failure

[Install]
WantedBy    = multi-user.target
EOF
```

ユニットファイルを `/etc/systemd/system に移動します`

```bash
sudo mv $HOME/validator.service /etc/systemd/system/validator.service
```

 権限を更新します。

```bash
sudo chmod 644 /etc/systemd/system/validator.service
```
{% endtab %}

{% tab title="Lodestar" %}
**validator.service** の設定を定義するために`ユニットファイル` を再作成するには、以下を実行します。 コピーして貼り付けるだけです。

```bash
cat > $HOME/validator.service << EOF 
# The eth2 validator service (part of systemd)
# file: /etc/systemd/system/validator.service 

[Unit]
Description     = eth2 validator service
Wants           = network-online.target beacon-chain.service
After           = network-online.target 

[Service]
User            = $(whoami)
WorkingDirectory= $(echo $HOME)/git/lodestar
ExecStart       = yarn run cli validator run --network pyrmont --graffiti "${MY_GRAFFITI}"
Restart         = on-failure

[Install]
WantedBy    = multi-user.target
EOF
```

ユニットファイルを `/etc/systemd/system に移動します`

```bash
sudo mv $HOME/validator.service /etc/systemd/system/validator.service
```

 権限を更新します。

```bash
sudo chmod 644 /etc/systemd/system/validator.service
```
{% endtab %}
{% endtabs %}

更新されたユニットファイルをリロードし、グラフィティを有効にするためにバリデータープロセスを再起動します。

{% tabs %}
{% tab title="Lighthouse \| Prysm \| Lodestar" %}
```bash
sudo systemctl daemon-reload
sudo systemctl restart validator
```
{% endtab %}

{% tab title="Teku \| Nimbus" %}
```
sudo systemctl daemon-reload
sudo systemctl restart beacon-chain
```
{% endtab %}
{% endtabs %}

### 📦 8.10 ETH1ノードを更新 - Geth / OpenEthereum / Besu / Nethermind

{% hint style="info" %}
随時、最新のETH1リリースにアップデートして、新たな改善や機能をお楽しみください。
{% endhint %}

eth1 ノードプロセスを停止します。

```bash
# 数分かかることがあります。
sudo systemctl stop eth1
```

eth1 ノードパッケージまたはバイナリを更新します。

{% tabs %}
{% tab title="Geth" %}
[https://github.com/etherum/go-ethereum/releases](https://github.com/ethereum/go-ethereum/releases)

```bash
sudo apt update
sudo apt upgrade -y
```
{% endtab %}

{% tab title="OpenEthereum \(Parity\)" %}
最新のリリースは [https://github.com/openetherum/openetherum/releases](https://github.com/openethereum/openethereum/releases)

最新のLinuxリリース、zip解除、実行権限の追加、クリーンアップを自動的にダウンロードします。

```bash
cd $HOME
# backup previous openethereum version in case of rollback
mv openethereum openethereum_backup_$(date +"%Y%d%m-%H%M%S")
# store new version in openethreum directory
mkdir openethereum && cd openethereum
# download latest version
curl -s https://api.github.com/repos/openethereum/openethereum/releases/latest | jq -r ".assets[] | select(.name) | .browser_download_url" | grep linux  | xargs wget -q --show-progress
# unzip
unzip openethereum*.zip
# add execute permission
chmod +x openethereum
# cleanup
rm openethereum*.zip
```
{% endtab %}

{% tab title="Besu" %}
最新のリリースは [https://github.com/hyperledger/besu/releases](https://github.com/hyperledger/besu/releases)

ファイルは [https://dl.bintray.com/hyperledger-org/besu-repo からダウンロードできます](https://dl.bintray.com/hyperledger-org/besu-repo)

上記のリポジトリから目的のファイルを手動で見つけて、URL で `wget` コマンドを変更します。

> 例 
> 
> wget -O besu.tar.gz [https://dl.bintray.com/hyperledger-org/besu-repo/besu-20.10.1.tar.gz](https://dl.bintray.com/hyperledger-org/besu-repo/besu-20.10.1.tar.gz)

```bash
cd $HOME
# backup previous besu version in case of rollback
mv besu besu_backup_$(date +"%Y%d%m-%H%M%S")
# download latest besu
wget -O besu.tar.gz <https URL to latest tax.gz linux file>
# untar
tar -xvf besu.tar.gz
# cleanup
rm besu.tar.gz
# rename besu to standard folder location
mv besu* besu
```
{% endtab %}

{% tab title="Nethermind" %}
最新のリリースは [https://github.com/NethermindEth/nethermind/releases で確認してください](https://github.com/NethermindEth/nethermind/releases)

最新のLinuxリリース、ZIP解除、クリーンアップを自動的にダウンロードします。

```bash
cd $HOME
# backup previous nethermind version in case of rollback
mv nethermind nethermind_backup_$(date +"%Y%d%m-%H%M%S")
# store new version in nethermind directory
mkdir nethermind && cd nethermind 
# download latest version
curl -s https://api.github.com/repos/NethermindEth/nethermind/releases/latest | jq -r ".assets[] | select(.name) | .browser_download_url" | grep linux  | xargs wget -q --show-progress
# unzip
unzip -o nethermind*.zip
# cleanup
rm nethermind*linux*.zip
```
{% endtab %}
{% endtabs %}

eth1ノードプロセスを開始します。

```bash
sudo systemctl start eth1
```

ログを確認して、サービスが正常に動作していることを確認し、エラーがないことを確認してください。

{% tabs %}
{% tab title="Lighthouse \| Prysm \| Lodestar" %}
```bash
sudo systemctl status eth1 status beacon-chain validator
```
{% endtab %}

{% tab title="Nimbus \| Teku" %}
```
sudo systemctl status eth1 beacon-chain
```
{% endtab %}
{% endtabs %}

最後に、検証者の認証がパブリックブロックエクスプローラで動作していることを確認してください。

[https://beaconcha.in/](https://beaconcha.in/)

ステータスを表示するには、バリデータのパブキーを入力してください。

### ✨ 8.11 検証の有効性を向上させる方法

{% hint style="info" %}
Attestant.ioから [認証有効性について](https://www.attestant.io/posts/defining-attestation-effectiveness/)
{% endhint %}

#### 👨👩👧👧 戦略 \#1: eth2ビーコンチェーンピアカウントを増加

{% hint style="info" %}
この変更により、帯域幅とメモリ使用量が増加します。 ハードウェアに適切に調整し、調整します。

__ [_Re’my Roy_](https://www.reddit.com/user/remyroy/) _for this strat._
{% endhint %}

`beacon-chain.service` ユニットファイル \(Teku\を除く) を編集します。

```bash
sudo nano /etc/systemd/system/beacon-chain.service
```

`ExecStart` 行でピアを増やすには、次のフラグを追加します。

{% tabs %}
{% tab title="Lighthouse" %}
```bash
--target-peers 100
# Example
# lighthouse bn --target-peers 100 --staking --metrics --network pyrmont
```
{% endtab %}

{% tab title="Nimbus" %}
```bash
--max-peers=100
# 例
# /usr/bin/nimbus_beacon_node --network=pyrmont --max-peers=100
```
{% endtab %}

{% tab title="Teku" %}
```bash
# teku.yaml の編集
sudo nano /etc/teku/teku.yaml

# teku.yaml に次の行を追加し、
p2p-peer-upper-bound: 100
```
{% endtab %}

{% tab title="Prysm" %}
```bash
--p2p-max-peers=100
# 例
# prysm.sh beaccon-chain --pyrmont --p2p-max-peers=100 --http-web3provider=http://127.0.0.1:8545 --accept-terms-of-use 
```
{% endtab %}

{% tab title="Lodestar" %}
```bash
--network.maxPeers 100
# 例
# yarn run cli beacon --network.maxPeers 100 --network pyrmont
```
{% endtab %}
{% endtabs %}

更新されたユニットファイルを再読み込みし、ビーコンチェーンプロセスを再起動して変更を完了します。

```bash
sudo systemctl daemon-reload
sudo systemctl restart beacon-chain
```

#### 👨💻 ストラテジー\#2: Eth1ノードの冗長性

{% hint style="info" %}
特に、eth1アップグレード中に、プライマリノードが一時的に利用できない場合に便利です。
{% endhint %}

`beacon-chain.service` ユニットファイルを編集します。

```bash
sudo nano /etc/systemd/system/beacon-chain.service
```

`ExecStart` 行に次のフラグを追加します。

{% tabs %}
{% tab title="Lighthouse" %}
```bash
--eth1-endpoints <http://alternate eth1 endpoints>
# 例
# --eth1-endpoints http://localhost:8545,http://nodes.mewapi.io/rpc/eth,https://mainnet.eth.cloud.ava.do,https://mainnet.infura.io/v3/xxx
```
{% endtab %}

{% tab title="Prysm" %}
```bash
--fallback-web3provider=<http://<alternate eth1 provider one> --fallback-web3provider=<http://<alternate eth1 provider two>
# 例, multiple eth1 providers
# --fallback-web3provider=https://nodes.mewapi.io/rpc/eth --fallback-web3provider=https://mainnet.infura.io/v3/YOUR-PROJECT-ID
```
{% endtab %}
{% endtabs %}

{% hint style="info" %}
💸 [https://ethereumnodes.com/](https://ethereumnodes.com/) で無料の ethereum fallback nodes を見つけます。
{% endhint %}

更新されたユニットファイルを再読み込みし、ビーコンチェーンプロセスを再起動して変更を完了します。

```bash
sudo systemctl daemon-reload
sudo systemctl restart beacon-chain
```

#### ⚙ Strategy \#3: 最長認証ギャップでアップデートまたは再起動を実行する

以下のクイックガイドをご覧ください。

{% page-ref page="guide-or-how-to-setup-a-validator-on-eth2-mainnet/how-to-find-longest-attest-slot-gap.md" %}

#### ⚙ ストラテジー \#4: ビーコンノード冗長性

{% hint style="info" %}
VC \(validator client\) が複数の BN \(beacon nodes\) に接続できるようにします。 これはバリデータクライアントが複数のBNを使用できることを意味します。 BNが応答しないと、VCは次のBNで再び試行します。

同じeth2クライアントのBNを別のサーバーにインストールする必要があります。

現在のみライトハウスのために動作します。
{% endhint %}

`validator.service` ユニットファイルを編集します。

```bash
sudo nano /etc/systemd/system/validator.service
```

`ExecStart` 行に次のフラグを追加します。

{% tabs %}
{% tab title="Lighthouse" %}
```bash
--beacon-nodes <BEACON-NODE ENDPOINTS>
# 例, コンマでエンドポイントを区切る.
# 灯台vc --beacon-nodes http://localhost:5052,http://192.168.1.100:5052
# localhostが応答しない場合 (アップデート中におそらく) VCは代わりに192.168.1.100を使用しようとします。
```
{% endtab %}
{% endtabs %}

更新されたユニットファイルを再読み込みし、バリデータープロセスを再起動して変更を完了します。

```bash
sudo systemctl daemon-reload
sudo systemctl restart validator
```

## 🌇 9. DiscordとRedditのコミュニティに参加する

### 📱 Discord

{% tabs %}
{% tab title="Lighthouse" %}
{% embed url="https://discord.gg/cyAszAh" %}
{% endtab %}

{% tab title="Nimbus" %}
{% embed url="https://discord.gg/XRxWahP" %}
{% endtab %}

{% tab title="Teku" %}
{% embed url="https://discord.gg/7hPv2T6" %}
{% endtab %}

{% tab title="Prysm" %}
{% embed url="https://discord.gg/XkyZSSK4My" %}
{% endtab %}

{% tab title="Lodestar" %}
{% embed url="https://discord.gg/aMxzVcr" %}
{% endtab %}

{% tab title="CoinCashew" %}
{% embed url="https://discord.gg/w8Bx8W2HPW" %}
{% endtab %}
{% endtabs %}

### 🌍 Reddit r/ethStaker

{% embed url="https://www.reddit.com/r/ethstaker/" %}

## 🧩10. 参照資料

このガイドを作成するための基礎となった以下のリンクで、立派な人々によって行われたハードワークを感謝します。

{% embed url="https://pyrmont.launchpad.ethereum.org/" %}

{% embed url="https://pegasys.tech/teku-ethereum-2-for-enterprise/" %}

{% embed url="https://docs.teku.pegasys.tech/en/latest/HowTo/Get-Started/Build-From-Source/" %}

{% embed url="https://lighthouse-book.sigmaprime.io/intro.html" caption="" %}

{% embed url="https://status-im.github.io/nimbus-eth2/intro.html" %}

{% embed url="https://prylabs.net/participate " %}

{% embed url="https://docs.prylabs.network/docs/getting-started/" %}

{% embed url="https://chainsafe.github.io/lodestar/installation/" %}

## 🎉11. ボーナスリンク

### 🧱 ETH2 Block Explorers

{% embed url="https://pyrmont.beaconcha.in/" %}

{% embed url="https://beaconscan.com/" caption="" %}

### 🗒最新のEth2情報

{% embed url="https://hackmd.io/@benjaminion/eth2\_news/" caption="" %}

{% embed url="https://www.reddit.com/r/ethstaker" caption="" %}

{% embed url="https://blog.etherum.org/" caption="" %}

### 👨👩👧👦 追加のETH2コミュニティガイド

{% embed url="https://someresat.medium.com/" %}

{% embed url="https://github.com/metanull-operator/eth2-ubuntu" %}

{% embed url="https://agstakingco.gitbook.io/eth-2-0-staking-guide-medalla/" %}

#### ハードウェアステーキングガイド [https://www.reddit.com/r/ethstaker/comments/j3mlup/a\_slightly\_updated\_look\_at\_hardware\_for\_staking/](https://www.reddit.com/r/ethstaker/comments/j3mlup/a_slightly_updated_look_at_hardware_for_staking/)

{% embed url="https://medium.com/@RaymondDurk/how-to-stake-for-ethere-2-0-with-dappnode-231fa7689c02" %}

{% embed url="https://kb.beaconcha.in/" %}

